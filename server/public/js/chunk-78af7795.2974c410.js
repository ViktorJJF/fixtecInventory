(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-78af7795"],{"13d5":function(t,e,a){"use strict";var r=a("23e7"),o=a("d58f").left,s=a("a640"),n=a("ae40"),c=s("reduce"),i=n("reduce",{1:0});r({target:"Array",proto:!0,forced:!c||!i},{reduce:function(t){return o(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}})},"51aa":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("custom-card",{attrs:{title:"Historial de compras",icon:"mdi-format-list-checks"},scopedSlots:t._u([{key:"content",fn:function(){return[a("v-col",{attrs:{cols:"12",sm:"12"}},[a("p",[a("strong",[t._v("Total de compras:")]),t._v(" "+t._s(t.$store.getters.getTotalPurchases)+" ")])]),a("v-data-table",{attrs:{loading:!t.isDataReady,"loading-text":"Cargando datos","hide-default-footer":"",headers:t.headers,items:t.purchases},on:{"page-count":function(e){t.pageCount=e}},scopedSlots:t._u([{key:"no-data",fn:function(){return[a("v-alert",{attrs:{type:"error",value:!0}},[t._v("Aún no cuentas con un historial de compras")])]},proxy:!0},{key:"item.actions",fn:function(e){var r=e.item;return[a("v-btn",{staticClass:"mr-3",attrs:{small:"",color:"secondary"},on:{click:function(e){e.stopPropagation(),t.dialog=!0,t.showOrderDetail(r)}}},[t._v("Ver detalle")]),a("v-btn",{attrs:{small:"",color:"error"},on:{click:function(e){return t.deleteItem(r)}}},[t._v("Eliminar")])]}},{key:"item.createdAt",fn:function(e){var a=e.item;return[t._v(t._s(t._f("formatDate")(a.createdAt)))]}},{key:"item.userId",fn:function(){return[t._v("Administrador")]},proxy:!0}])}),a("div",{staticClass:"text-center pt-2"},[a("v-pagination",{attrs:{length:1},model:{value:t.page,callback:function(e){t.page=e},expression:"page"}})],1),a("v-dialog",{attrs:{width:"500"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[t.isDataReady?a("v-card",[a("v-toolbar",{attrs:{color:"secondary",dark:""}},[a("v-toolbar-title",[t._v("Detalle de compra")])],1),a("v-container",[a("p",[a("strong",[t._v("ID de la compra:")]),t._v(" "+t._s(t.purchases.length>0?t.purchases[t.selectedOrder]._id:"")+" ")]),a("p",[a("strong",[t._v("Usuario:")]),t._v(" Administrador ")]),a("p",[a("strong",[t._v("Detalle de productos comprados:")])]),a("v-simple-table",{scopedSlots:t._u([{key:"default",fn:function(){return[a("thead",[a("tr",[a("th",{staticClass:"text-left"},[t._v("Producto")]),a("th",{staticClass:"text-left"},[t._v("Precio de compra")]),a("th",{staticClass:"text-left"},[t._v("Cantidad")]),a("th",{staticClass:"text-left"},[t._v("Subtotal")])])]),a("tbody",t._l(t.purchaseDetails,(function(e){return a("tr",{key:e._id},[a("td",[t._v(t._s(t.$store.getters.getProductById(e.productId)))]),a("td",[t._v("S/. "+t._s(e.purchasePrice))]),a("td",[t._v(t._s(e.qty))]),a("td",[t._v("S/. "+t._s(e.purchasePrice*e.qty))])])})),0)]},proxy:!0}],null,!1,2332756782)}),a("v-row",{staticClass:"mr-3",attrs:{justify:"end"}},[a("v-card",{staticClass:"pa-3",attrs:{outlined:"",color:"red lighten-5"}},[a("strong",{staticClass:"mr-3"},[t._v("Total:")]),t._v(" "),a("span",{staticClass:"total"},[t._v("S/."+t._s(t.getTotal))])])],1)],1),a("v-divider"),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"primary",text:""},on:{click:function(e){t.dialog=!1,t.clearPurchaseDetails()}}},[t._v("De acuerdo")])],1)],1):t._e()],1)]},proxy:!0}])})},o=[],s=(a("4160"),a("c975"),a("13d5"),a("a434"),a("159b"),a("96cf"),a("1da1")),n=a("bc3a"),c=a.n(n),i=a("b166"),l=a("5952"),d={filters:{formatDate:function(t){return Object(i["a"])(new Date(t),"dd/MM/yyyy")}},data:function(){return{isDataReady:!1,selectedOrder:0,search:"",dialog:!1,page:1,pageCount:0,itemsPerPage:10,headers:[{text:"ID de compra",value:"_id"},{text:"Usuario",value:"userId"},{text:"Fecha",value:"createdAt"},{text:"Acciones",value:"actions"}],purchases:[],purchaseDetails:[]}},computed:{formTitle:function(){return"Editar producto"},brands:function(){return this.$store.getters.getBrands},types:function(){return this.$store.getters.getTypes},colors:function(){return this.$store.getters.getColors},getTotal:function(){return this.purchaseDetails.reduce((function(t,e){return t+e.purchasePrice*e.qty}),0)}},created:function(){this.initialData()},methods:{initialData:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("loadInitialPurchases");case 2:t.purchases=e.sent,t.isDataReady=!0;case 4:case"end":return e.stop()}}),e)})))()},showOrderDetail:function(t){var e=this;this.selectedOrder=this.purchases.indexOf(t);var a=this.purchases[this.selectedOrder]._id;c.a.get("/api/purchase-details/list",{params:{purchaseId:a}}).then((function(t){console.log(t),t.data.ok&&(e.purchaseDetails=t.data.payload)})).catch((function(t){console.error(t)}))},clearPurchaseDetails:function(){this.purchaseDetails=[]},deleteItem:function(t){var e=this,a=this.purchases.indexOf(t),r=this.purchases[a]._id;confirm("¿Seguro que deseas eliminar esta compra? Se sumará el stock a los productos del detalle")&&(this.updateStoreStock(r),this.$store.dispatch("showOverlay",!0),Object(l["a"])("delete","/api/purchases/delete/"+r,null,(function(){e.$store.dispatch("showOverlay",!1),e.purchases.splice(a,1)})))},updateStoreStock:function(t){var e=this;c.a.get("/api/purchase-details/list",{params:{purchaseId:t}}).then((function(t){if(console.log(t),t.data.ok){var a=t.data.payload;a.forEach((function(t){e.$store.dispatch("updateStock",{type:"purchase",productId:t.productId,qty:-parseInt(t.qty)})}))}})).catch((function(t){console.error(t)}))}}},u=d,p=a("2877"),f=a("6544"),h=a.n(f),v=a("0798"),g=a("8336"),m=a("b0af"),_=a("99d9"),y=a("62ad"),b=a("a523"),x=a("8fea"),k=a("169a"),D=a("ce7e"),w=a("891e"),O=a("0fd9"),C=a("1f4f"),S=a("2fa4"),V=a("71d9"),A=a("2a7f"),I=Object(p["a"])(u,r,o,!1,null,"51df5bee",null);e["default"]=I.exports;h()(I,{VAlert:v["a"],VBtn:g["a"],VCard:m["a"],VCardActions:_["b"],VCol:y["a"],VContainer:b["a"],VDataTable:x["a"],VDialog:k["a"],VDivider:D["a"],VPagination:w["a"],VRow:O["a"],VSimpleTable:C["a"],VSpacer:S["a"],VToolbar:V["a"],VToolbarTitle:A["c"]})},5952:function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));var r=a("4360"),o=a("bc3a"),s=a.n(o),n=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};s.a[t](e,a).then((function(t){console.log(t.data),r["a"].dispatch("showSnackbar",{text:t.data.message,color:"success"}),t.data.ok&&o(null,t.data.payload)})).catch((function(t){console.log("hubo un error en la llamada a la api"),"ECONNABORTED"===t.code&&(console.log("se excedio el tiempo limite"),r["a"].dispatch("showSnackbar",{text:"Algo salió mal",color:"error"})),r["a"].dispatch("showSnackbar",{text:t.response.data.message,color:"error"}),console.error(t),o(t)}))}},c975:function(t,e,a){"use strict";var r=a("23e7"),o=a("4d64").indexOf,s=a("a640"),n=a("ae40"),c=[].indexOf,i=!!c&&1/[1].indexOf(1,-0)<0,l=s("indexOf"),d=n("indexOf",{ACCESSORS:!0,1:0});r({target:"Array",proto:!0,forced:i||!l||!d},{indexOf:function(t){return i?c.apply(this,arguments)||0:o(this,t,arguments.length>1?arguments[1]:void 0)}})},d58f:function(t,e,a){var r=a("1c0b"),o=a("7b0b"),s=a("44ad"),n=a("50c4"),c=function(t){return function(e,a,c,i){r(a);var l=o(e),d=s(l),u=n(l.length),p=t?u-1:0,f=t?-1:1;if(c<2)while(1){if(p in d){i=d[p],p+=f;break}if(p+=f,t?p<0:u<=p)throw TypeError("Reduce of empty array with no initial value")}for(;t?p>=0:u>p;p+=f)p in d&&(i=a(i,d[p],p,l));return i}};t.exports={left:c(!1),right:c(!0)}}}]);
//# sourceMappingURL=chunk-78af7795.2974c410.js.map