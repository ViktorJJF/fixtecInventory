(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-60956168"],{"062c":function(t,e,s){},"35c6":function(t,e,s){"use strict";var r=s("062c"),a=s.n(r);a.a},f32d:function(t,e,s){"use strict";s.r(e);var r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("custom-card",{attrs:{title:"Realizar compra",icon:"mdi-plus"},scopedSlots:t._u([{key:"content",fn:function(){return[s("v-container",[s("v-alert",{directives:[{name:"show",rawName:"v-show",value:t.historyMode,expression:"historyMode"}],attrs:{prominent:"",type:"error"}},[s("v-col",{staticClass:"grow"},[t._v("Aviso: Estás en el modo de compras históricas, por lo que las compras que registres no modificarán tu stock actual.")])],1),s("v-row",{attrs:{align:"center",dense:""}},[s("p",{staticClass:"body-1 font-weight-bold d-inline mx-3"},[t._v("Fecha:")]),s("v-col",{attrs:{cols:"12",sm:"12",md:"3"}},[s("v-text-field",{staticClass:"date-width",attrs:{outlined:"",dense:"","prepend-icon":"event",type:"date"},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1),s("v-col",{staticClass:"d-flex",attrs:{cols:"12",sm:"4"}},[s("v-select",{attrs:{items:t.commerce,label:"Selecciona el negocio",outlined:"",dense:""},model:{value:t.selectedCommerce,callback:function(e){t.selectedCommerce=e},expression:"selectedCommerce"}})],1),s("v-spacer"),s("v-switch",{staticClass:"mb-5",attrs:{label:"Modo histórico: "+(t.historyMode?"Activo":"Inactivo")},model:{value:t.historyMode,callback:function(e){t.historyMode=e},expression:"historyMode"}})],1),s("v-btn",{staticClass:"my-3",attrs:{tile:"",color:"primary"}},[s("v-icon",{attrs:{left:""}},[t._v("search")]),t._v("Búsqueda ")],1),s("v-autocomplete",{staticClass:"search-field mr-3",attrs:{placeholder:"Escribe el nombre del producto",loading:t.productsLoading,items:t.products,"item-text":"name","item-value":"_id","return-object":!0,dense:"",outlined:""},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addPurchase(t.selectedProduct)},click:t.productsList,change:function(e){return t.addPurchase(t.selectedProduct)}},scopedSlots:t._u([{key:"no-data",fn:function(){return[t.productsLoading?s("v-container",{staticClass:"text-center",attrs:{fluid:""}},[s("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1):t._e()]},proxy:!0}]),model:{value:t.selectedProduct,callback:function(e){t.selectedProduct=e},expression:"selectedProduct"}}),s("v-btn",{attrs:{outlined:"",color:"primary",to:{name:"historyPurchase"}}},[s("v-icon",{attrs:{left:""}},[t._v("mdi-format-list-checks")]),t._v("Ver historial ")],1),s("v-simple-table",{scopedSlots:t._u([{key:"default",fn:function(){return[s("thead",[s("tr",[s("th",{staticClass:"text-left"},[s("span",[t._v("Tipo")])]),s("th",{staticClass:"text-left"},[s("span",[t._v("Producto")])]),s("th",{staticClass:"text-left"},[s("span",[t._v("Cantidad")])]),s("th",{staticClass:"text-left"},[s("span",[t._v("Precio de compra")])]),s("th",{staticClass:"text-left"},[s("span",[t._v("Subtotal")])]),s("th",{staticClass:"text-left"},[s("span",[t._v("Eliminar producto")])])])]),s("tbody",t._l(t.purchases,(function(e,r){return s("tr",{key:"a"+r},[s("td",[t._v(t._s(e.productDetails.typeId?e.productDetails.typeId.name:"Sin tipo"))]),s("td",[t._v(t._s(e.productDetails.name))]),s("td",[s("v-text-field",{staticClass:"inputs-width",attrs:{suffix:"unidades",type:"number"},model:{value:e.qty,callback:function(s){t.$set(e,"qty",s)},expression:"product.qty"}})],1),s("td",[s("v-text-field",{staticClass:"inputs-width",attrs:{prefix:"S/.",type:"number"},model:{value:e.purchasePrice,callback:function(s){t.$set(e,"purchasePrice",s)},expression:"product.purchasePrice"}})],1),s("td",[t._v("S/."+t._s(e.purchasePrice*e.qty))]),s("td",[s("v-btn",{attrs:{small:"",color:"error"},on:{click:function(e){return t.deletePurchase(r)}}},[t._v("Eliminar")])],1)])})),0)]},proxy:!0}])}),s("v-alert",{directives:[{name:"show",rawName:"v-show",value:0==t.purchases.length,expression:"purchases.length==0"}],staticClass:"my-5",attrs:{type:"warning",text:""}},[t._v("Aún no agregaste productos a esta compra")]),s("v-row",{staticClass:"mr-3 mb-3",attrs:{justify:"end"}},[s("v-card",{staticClass:"pa-3",attrs:{dark:"",outlined:"",color:"info"}},[s("strong",{staticClass:"text--white"},[t._v("Total:")]),t._v(" "),s("span",{staticClass:"total"},[t._v("S/."+t._s(t.getTotal))])])],1),s("v-btn",{attrs:{loading:t.loadingButton,color:"success"},on:{click:function(e){return t.savePurchase(t.purchases,t.date,t.selectedCommerce)}}},[t._v("Terminar compra")])],1)]},proxy:!0}])})},a=[],c=(s("13d5"),s("a434"),s("b85c")),o=(s("96cf"),s("1da1")),n={data:function(){return{commerce:["VENTA DE ACCESORIOS","VENTA DE REPUESTOS","SOFTWARE","HARDWARE","CELULARES"],selectedCommerce:"",historyMode:!1,selectedProduct:null,date:(new Date).toISOString().substr(0,10),menu:!1,purchases:[],total:0,productsLoading:!1,loadingButton:!1}},methods:{deletePurchase:function(t){this.purchases.splice(t,1)},addPurchase:function(t){t&&this.purchases.push({productDetails:t,productId:t._id,qty:1,purchasePrice:t.purchasePrice,history:this.historyMode})},savePurchase:function(t,e,s){var r=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var o,n,i,l,u,d,p,h,m,f,v,y;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:r.loadingButton=!0,t=r.$deepCopy(t),o=Object(c["a"])(t);try{for(o.s();!(n=o.n()).done;)i=n.value,delete i["productDetails"]}catch(b){o.e(b)}finally{o.f()}if(r.historyMode){l=Object(c["a"])(t);try{for(l.s();!(u=l.n()).done;)d=u.value,d.history=!0}catch(b){l.e(b)}finally{l.f()}}else{p=Object(c["a"])(t);try{for(p.s();!(h=p.n()).done;)m=h.value,m.history=!1}catch(b){p.e(b)}finally{p.f()}}return a.prev=5,e=new Date(e),e=new Date(e.getTime()- -6e4*e.getTimezoneOffset()),a.next=10,r.$store.dispatch("purchasesModule/create",{products:t,date:e,commerce:s});case 10:f=Object(c["a"])(t);try{for(f.s();!(v=f.n()).done;)y=v.value,y.history||r.$store.commit("productsModule/updateStock",{productId:y.productId,qty:+y.qty})}catch(b){f.e(b)}finally{f.f()}r.purchases=[];case 13:return a.prev=13,r.loadingButton=!1,a.finish(13);case 16:case"end":return a.stop()}}),a,null,[[5,,13,16]])})))()},productsList:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!==t.products.length){e.next=8;break}return t.productsLoading=!0,e.prev=2,e.next=5,t.$store.dispatch("productsModule/list");case 5:return e.prev=5,t.productsLoading=!1,e.finish(5);case 8:case"end":return e.stop()}}),e,null,[[2,,5,8]])})))()}},computed:{products:function(){return this.$store.state.productsModule.products},getTotal:function(){return this.purchases.reduce((function(t,e){return t+e.purchasePrice*e.qty}),0)}}},i=n,l=(s("35c6"),s("2877")),u=s("6544"),d=s.n(u),p=s("0798"),h=s("c6a6"),m=s("8336"),f=s("b0af"),v=s("62ad"),y=s("a523"),b=s("132d"),x=s("490a"),C=s("0fd9"),g=s("b974"),_=s("1f4f"),w=s("2fa4"),k=s("b73d"),P=s("8654"),S=Object(l["a"])(i,r,a,!1,null,"61a99d00",null);e["default"]=S.exports;d()(S,{VAlert:p["a"],VAutocomplete:h["a"],VBtn:m["a"],VCard:f["a"],VCol:v["a"],VContainer:y["a"],VIcon:b["a"],VProgressCircular:x["a"],VRow:C["a"],VSelect:g["a"],VSimpleTable:_["a"],VSpacer:w["a"],VSwitch:k["a"],VTextField:P["a"]})}}]);
//# sourceMappingURL=chunk-60956168.022fa20f.js.map