(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4161face"],{"0eb3":function(e,t,a){"use strict";var s=a("7043"),r=a.n(s);r.a},7043:function(e,t,a){},af81:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("custom-card",{attrs:{title:"Realizar venta",icon:"mdi-plus"},scopedSlots:e._u([{key:"content",fn:function(){return[a("v-container",[a("v-alert",{directives:[{name:"show",rawName:"v-show",value:e.historyMode,expression:"historyMode"}],attrs:{prominent:"",type:"error"}},[a("v-col",{staticClass:"grow"},[e._v("Aviso: Estás en el modo de ventas históricas, por lo que las ventas que registres no modificarán tu stock actual.")])],1),a("v-row",{attrs:{align:"center"}},[a("p",{staticClass:"body-1 font-weight-bold d-inline mx-3"},[e._v("Fecha:")]),a("v-menu",{attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"","max-width":"290px","min-width":"290px"},scopedSlots:e._u([{key:"activator",fn:function(t){var s=t.on,r=t.attrs;return[a("v-text-field",e._g(e._b({staticClass:"date-width",attrs:{"persistent-hint":"","prepend-inner-icon":"event",readonly:"",outlined:"",dense:""},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}},"v-text-field",r,!1),s))]}}]),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[a("v-date-picker",{attrs:{"no-title":""},on:{input:function(t){e.menu=!1}},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})],1),a("v-col",{staticClass:"d-flex",attrs:{cols:"12",sm:"6"}},[a("v-select",{attrs:{items:e.commerce,label:"Selecciona el negocio",outlined:"",dense:""},model:{value:e.selectedCommerce,callback:function(t){e.selectedCommerce=t},expression:"selectedCommerce"}})],1),a("v-spacer"),a("v-switch",{attrs:{label:"Modo histórico: "+(e.historyMode?"Activo":"Inactivo")},model:{value:e.historyMode,callback:function(t){e.historyMode=t},expression:"historyMode"}})],1),a("v-btn",{staticClass:"my-3",attrs:{tile:"",color:"primary"}},[a("v-icon",{attrs:{left:""}},[e._v("search")]),e._v("Búsqueda ")],1),a("v-autocomplete",{staticClass:"search-field mr-3",attrs:{placeholder:"Escribe el nombre del producto",loading:e.productsLoading,items:e.products,"item-text":"name","item-value":"_id","return-object":!0,dense:"",outlined:""},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addSale(e.selectedProduct)},click:e.productsList,change:function(t){return e.addSale(e.selectedProduct)}},scopedSlots:e._u([{key:"no-data",fn:function(){return[e.productsLoading?a("v-container",{staticClass:"text-center",attrs:{fluid:""}},[a("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1):e._e()]},proxy:!0}]),model:{value:e.selectedProduct,callback:function(t){e.selectedProduct=t},expression:"selectedProduct"}}),a("v-btn",{attrs:{outlined:"",color:"primary",to:{name:"salesHistory"}}},[a("v-icon",{attrs:{left:""}},[e._v("mdi-format-list-checks")]),e._v("Ver historial ")],1),a("v-simple-table",{scopedSlots:e._u([{key:"default",fn:function(){return[a("thead",[a("tr",[a("th",{staticClass:"text-left"},[a("span",[e._v("Producto")])]),a("th",{staticClass:"text-left"},[a("span",[e._v("Cantidad")])]),a("th",{staticClass:"text-left"},[a("span",[e._v("Precio de compra")])]),a("th",{staticClass:"text-left"},[a("span",[e._v("Precio de venta")])]),a("th",{staticClass:"text-left"},[a("span",[e._v("Subtotal")])]),a("th",{staticClass:"text-left"},[a("span",[e._v("Eliminar producto")])])])]),a("tbody",e._l(e.sales,(function(t,s){return a("tr",{key:"a"+s},[a("td",[e._v(e._s(t.productDetails.name))]),a("td",[a("v-text-field",{staticClass:"inputs-width",attrs:{suffix:"unidades",type:"number"},model:{value:t.qty,callback:function(a){e.$set(t,"qty",a)},expression:"product.qty"}})],1),a("td",[e.editPurchasePrice?a("v-text-field",{staticClass:"inputs-width",attrs:{prefix:"S/.",type:"number"},model:{value:t.purchasePrice,callback:function(a){e.$set(t,"purchasePrice",a)},expression:"product.purchasePrice"}}):a("v-btn",{attrs:{color:"error",outlined:"",small:""},on:{click:function(t){e.editPurchasePrice=!0}}},[e._v("Editar")])],1),a("td",[a("v-text-field",{staticClass:"inputs-width",attrs:{prefix:"S/.",type:"number"},model:{value:t.salePrice,callback:function(a){e.$set(t,"salePrice",a)},expression:"product.salePrice"}})],1),a("td",[e._v("S/."+e._s(t.salePrice*t.qty))]),a("td",[a("v-btn",{attrs:{small:"",color:"error"},on:{click:function(t){return e.deleteSale(s)}}},[e._v("Eliminar")])],1)])})),0)]},proxy:!0}])}),a("v-alert",{directives:[{name:"show",rawName:"v-show",value:0==e.sales.length,expression:"sales.length==0"}],staticClass:"my-5",attrs:{type:"warning",text:""}},[e._v("Aún no agregaste productos a esta venta")]),a("v-row",{staticClass:"mr-3 mb-3",attrs:{justify:"end"}},[a("v-card",{staticClass:"pa-3",attrs:{dark:"",outlined:"",color:"info"}},[a("strong",{staticClass:"text--white"},[e._v("Total:")]),e._v(" "),a("span",{staticClass:"total"},[e._v("S/."+e._s(e.getTotal))])])],1),a("v-btn",{attrs:{loading:e.loadingButton,color:"success"},on:{click:function(t){return e.saveSale(e.sales,e.date,e.selectedCommerce)}}},[e._v("Terminar venta")])],1)]},proxy:!0}])})},r=[],n=(a("13d5"),a("a434"),a("b85c")),o=(a("96cf"),a("1da1")),c={data:function(){return{commerce:["VENTA DE ACCESORIOS","VENTA DE REPUESTOS","SOFTWARE","HARDWARE","CELULARES"],selectedCommerce:"",editPurchasePrice:!1,historyMode:!1,selectedProduct:null,date:(new Date).toISOString().substr(0,10),menu:!1,sales:[],total:0,productsLoading:!1,loadingButton:!1}},methods:{deleteSale:function(e){this.sales.splice(e,1)},addSale:function(e){e&&this.sales.push({productDetails:e,productId:e._id,qty:1,purchasePrice:e.purchasePrice,salePrice:e.price,history:this.historyMode})},saveSale:function(e,t,a){var s=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var o,c,i,l,d,u,p,v,f,m,h,y,b,x,w,g,_,k;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:s.loadingButton=!0,e=s.$deepCopy(e),o=Object(n["a"])(e);try{for(o.s();!(c=o.n()).done;)i=c.value,delete i["productDetails"]}catch(C){o.e(C)}finally{o.f()}if(s.historyMode){l=Object(n["a"])(e);try{for(l.s();!(d=l.n()).done;)u=d.value,u.history=!0}catch(C){l.e(C)}finally{l.f()}}else{p=Object(n["a"])(e);try{for(p.s();!(v=p.n()).done;)f=v.value,f.history=!1}catch(C){p.e(C)}finally{p.f()}}return m=new Date,h=m.getDate(),y=m.getHours(),b=m.getMinutes(),x=m.getSeconds(),w=new Date(t),w=new Date(w.setDate(h)),w=new Date(w.setHours(y)),w=new Date(w.setMinutes(b)),w=new Date(w.setSeconds(x)),r.prev=15,r.next=18,s.$store.dispatch("salesModule/create",{products:e,date:w,commerce:a});case 18:g=Object(n["a"])(e);try{for(g.s();!(_=g.n()).done;)k=_.value,k.history||s.$store.commit("productsModule/updateStock",{productId:k.productId,qty:-k.qty})}catch(C){g.e(C)}finally{g.f()}s.sales=[];case 21:return r.prev=21,s.loadingButton=!1,r.finish(21);case 24:case"end":return r.stop()}}),r,null,[[15,,21,24]])})))()},productsList:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!==e.products.length){t.next=8;break}return e.productsLoading=!0,t.prev=2,t.next=5,e.$store.dispatch("productsModule/list");case 5:return t.prev=5,e.productsLoading=!1,t.finish(5);case 8:case"end":return t.stop()}}),t,null,[[2,,5,8]])})))()}},computed:{products:function(){return this.$store.state.productsModule.products},getTotal:function(){return this.sales.reduce((function(e,t){return e+t.salePrice*t.qty}),0)}}},i=c,l=(a("0eb3"),a("2877")),d=a("6544"),u=a.n(d),p=a("0798"),v=a("c6a6"),f=a("8336"),m=a("b0af"),h=a("62ad"),y=a("a523"),b=a("2e4b"),x=a("132d"),w=a("e449"),g=a("490a"),_=a("0fd9"),k=a("b974"),C=a("1f4f"),S=a("2fa4"),P=a("b73d"),V=a("8654"),E=Object(l["a"])(i,s,r,!1,null,"70d0651e",null);t["default"]=E.exports;u()(E,{VAlert:p["a"],VAutocomplete:v["a"],VBtn:f["a"],VCard:m["a"],VCol:h["a"],VContainer:y["a"],VDatePicker:b["a"],VIcon:x["a"],VMenu:w["a"],VProgressCircular:g["a"],VRow:_["a"],VSelect:k["a"],VSimpleTable:C["a"],VSpacer:S["a"],VSwitch:P["a"],VTextField:V["a"]})}}]);
//# sourceMappingURL=chunk-4161face.ee5c8d3c.js.map