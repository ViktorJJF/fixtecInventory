(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ff03b7d8"],{"13d5":function(t,e,r){"use strict";var a=r("23e7"),c=r("d58f").left,o=r("a640"),s=r("ae40"),n=o("reduce"),i=s("reduce",{1:0});a({target:"Array",proto:!0,forced:!n||!i},{reduce:function(t){return c(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}})},"4c9b":function(t,e,r){},"54d3":function(t,e,r){"use strict";var a=r("4c9b"),c=r.n(a);c.a},d58f:function(t,e,r){var a=r("1c0b"),c=r("7b0b"),o=r("44ad"),s=r("50c4"),n=function(t){return function(e,r,n,i){a(r);var u=c(e),d=o(u),l=s(u.length),p=t?l-1:0,h=t?-1:1;if(n<2)while(1){if(p in d){i=d[p],p+=h;break}if(p+=h,t?p<0:l<=p)throw TypeError("Reduce of empty array with no initial value")}for(;t?p>=0:l>p;p+=h)p in d&&(i=r(i,d[p],p,u));return i}};t.exports={left:n(!1),right:n(!0)}},f32d:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("custom-card",{attrs:{title:"Realizar compra",icon:"mdi-plus"},scopedSlots:t._u([{key:"content",fn:function(){return[r("v-container",[r("v-btn",{staticClass:"mr-3 my-3",attrs:{color:"primary"},on:{click:t.addpurchase}},[r("v-icon",{attrs:{left:""}},[t._v("mdi-plus")]),t._v("Agregar ")],1),r("v-btn",{attrs:{color:"primary",to:{name:"historyPurchase"}}},[r("v-icon",{attrs:{left:""}},[t._v("mdi-magnify")]),t._v("Ver historial ")],1),r("v-alert",{directives:[{name:"show",rawName:"v-show",value:0==t.purchase.length,expression:"purchase.length==0"}],staticClass:"my-5",attrs:{color:"error",text:""}},[t._v("Agrega productos a esta compra")]),r("v-alert",{attrs:{text:"",type:"error",value:t.validateError}},[t._v("Es necesario agregar al menos 1 producto")]),r("v-simple-table",{scopedSlots:t._u([{key:"default",fn:function(){return[r("thead",[r("tr",[r("th",{staticClass:"text-left"},[t._v("Producto")]),r("th",{staticClass:"text-left"},[t._v("Cantidad")]),r("th",{staticClass:"text-left"},[t._v("Precio")]),r("th",{staticClass:"text-left"},[t._v("Subtotal")]),r("th",{staticClass:"text-left"},[t._v("Eliminar producto")])])]),r("tbody",t._l(t.purchase,(function(e,a){return r("tr",{key:e.productId},[r("td",[r("v-container",[r("v-select",{attrs:{placeholder:"Seleccione el producto",suffix:"Stock:"+t.$store.getters.getproductStock(e.productId),items:t.products,"item-text":"model","item-value":"_id"},on:{change:function(r){t.purchase[a].purchasePrice=t.getProductPurchasePrice(e.productId)}},model:{value:e.productId,callback:function(r){t.$set(e,"productId",r)},expression:"product.productId"}})],1)],1),r("td",[r("v-text-field",{attrs:{type:"number"},model:{value:e.qty,callback:function(r){t.$set(e,"qty",r)},expression:"product.qty"}})],1),r("td",[t._v("S/."+t._s(e.purchasePrice))]),r("td",[t._v("S/."+t._s(e.purchasePrice*e.qty))]),r("td",[r("v-btn",{attrs:{small:"",color:"error"},on:{click:function(e){return t.deletepurchase(a)}}},[t._v("Eliminar")])],1)])})),0)]},proxy:!0}])}),r("v-row",{staticClass:"mr-3",attrs:{justify:"end"}},[r("v-card",{staticClass:"pa-3",attrs:{outlined:"",color:"red lighten-5"}},[r("strong",{staticClass:"mr-3"},[t._v("Total:")]),t._v(" "),r("span",{staticClass:"total"},[t._v("S/."+t._s(t.getTotal))])])],1),r("v-alert",{attrs:{text:"",type:"error",value:t.stockError}},[t._v("La cantidad vendida no puede superar el stock")]),r("v-btn",{attrs:{loading:t.loadingButton,color:"success"},on:{click:t.savepurchase}},[t._v("Guardar compra")])],1)]},proxy:!0}])})},c=[],o=(r("4160"),r("13d5"),r("a434"),r("d3b7"),r("159b"),r("96cf"),r("1da1")),s=r("bc3a"),n=r.n(s),i={data:function(){return{purchase:[],total:0,loadingButton:!1,validateError:!1,stockError:!1}},methods:{deletepurchase:function(t){this.purchase.splice(t,1)},addpurchase:function(){this.purchase.push({productId:"",qty:1,purchasePrice:0})},getProductPurchasePrice:function(t){return this.$store.getters.getProductPurchasePrice(t)},validateForm:function(){return 0===this.purchase.length?(this.validateError=!0,!1):(this.stockError=!1,this.validateError=!1,!0)},savepurchase:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.validateForm()){e.next=2;break}return e.abrupt("return",!1);case 2:return t.loadingButton=!0,t.$store.dispatch("showOverlay",!0),e.next=6,t.apiCalls();case 6:t.updateStoreStock(),t.$store.dispatch("showSnackbar",{text:"Venta agregada con Ã©xito",color:"success"}),t.loadingButton=!1,t.$store.dispatch("showOverlay",!1),t.purchase=[];case 11:case"end":return e.stop()}}),e)})))()},updateStoreStock:function(){var t=this;this.purchase.forEach((function(e){t.$store.dispatch("updateStock",{type:"purchase",productId:e.productId,qty:parseInt(e.qty)})}))},apiCalls:function(){var t=this;return new Promise((function(e,r){n.a.post("/api/purchases/create",{userId:t.$store.getters.getUserId}).then((function(a){var c=a.data.payload._id;t.purchase.forEach((function(t){n.a.post("/api/purchase-details/create",{purchaseId:c,productId:t.productId,purchasePrice:t.purchasePrice,qty:parseInt(t.qty)}).then((function(t){console.log(t),e()})).catch((function(t){console.error(t),r(t)}))}))})).catch((function(t){console.error(t)}))}))}},computed:{products:function(){return this.$store.getters.getProducts},getTotal:function(){var t=this;return this.purchase.reduce((function(e,r){return e+t.getProductPurchasePrice(r.productId)*r.qty}),0)}}},u=i,d=(r("54d3"),r("2877")),l=r("6544"),p=r.n(l),h=r("0798"),f=r("8336"),v=r("b0af"),g=r("a523"),m=r("132d"),y=r("0fd9"),b=r("b974"),_=r("1f4f"),k=r("8654"),x=Object(d["a"])(u,a,c,!1,null,"8d9633ce",null);e["default"]=x.exports;p()(x,{VAlert:h["a"],VBtn:f["a"],VCard:v["a"],VContainer:g["a"],VIcon:m["a"],VRow:y["a"],VSelect:b["a"],VSimpleTable:_["a"],VTextField:k["a"]})}}]);
//# sourceMappingURL=chunk-ff03b7d8.28bc255b.js.map