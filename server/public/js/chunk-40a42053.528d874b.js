(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-40a42053"],{1148:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("custom-card",{attrs:{title:"Historial de ventas",icon:"mdi-format-list-checks"},scopedSlots:e._u([{key:"content",fn:function(){return[r("v-row",{staticClass:"mb-3",attrs:{align:"center"}},[r("v-col",{attrs:{cols:"12",sm:"4"}},[r("span",{staticClass:"body-1 font-weight-bold d-inline mx-3"},[e._v("Desde:")]),r("v-text-field",{staticClass:"mr-3 mb-3",attrs:{outlined:"",dense:"","prepend-icon":"event",type:"date","hide-details":"",clearable:""},model:{value:e.filters.startDate,callback:function(t){e.$set(e.filters,"startDate",t)},expression:"filters.startDate"}})],1),r("v-col",{attrs:{cols:"12",sm:"4"}},[r("span",{staticClass:"body-1 font-weight-bold d-inline mx-3"},[e._v("Hasta:")]),r("v-text-field",{staticClass:"mr-3 mb-3",attrs:{outlined:"",dense:"","prepend-icon":"event",type:"date","hide-details":"",clearable:""},model:{value:e.filters.endDate,callback:function(t){e.$set(e.filters,"endDate",t)},expression:"filters.endDate"}})],1),r("v-col",{attrs:{cols:"12",sm:"4"}},[r("span",{staticClass:"body-1 font-weight-bold d-inline mx-3"},[e._v("Negocio:")]),r("v-select",{staticClass:"mr-3 mb-3",attrs:{clearable:"","hide-details":"",dense:"",placeholder:"Selecciona un negocio",items:e.commerce,outlined:""},on:{"click:clear":function(t){e.filters.commerce=null}},model:{value:e.filters.commerce,callback:function(t){e.$set(e.filters,"commerce",t)},expression:"filters.commerce"}})],1),r("v-col",{attrs:{cols:"12",sm:"6"}},[r("span",{staticClass:"body-1 font-weight-bold d-inline mx-3"},[e._v("Filtrar por producto:")]),r("v-dialog",{attrs:{width:"1200"},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[r("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[r("v-btn",e._g({staticClass:"my-3 mr-3",attrs:{tile:"",color:"primary"}},Object.assign({},n,a)),[r("v-icon",{attrs:{left:""}},[e._v("search")]),e._v("Seleccionar producto ")],1)]}}],null,!0)},[r("span",[e._v("Inventario")])])]}}]),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[r("v-card",[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[e._v("Productos")])],1),r("v-container",[r("products",{attrs:{selectButton:!0},on:{"add-product":function(t){e.filters.product=t._id,e.dialog=!1}}})],1),r("v-divider"),r("v-card-actions",[r("v-spacer"),r("v-btn",{attrs:{color:"primary",text:""},on:{click:function(t){e.dialog=!1}}},[e._v("De acuerdo")])],1)],1)],1)],1),r("v-col",{attrs:{cols:"12",sm:"6"}},[r("v-row",{directives:[{name:"show",rawName:"v-show",value:e.filters.product,expression:"filters.product"}]},[e.filters.product?r("v-simple-table",{scopedSlots:e._u([{key:"default",fn:function(){return[r("thead",[r("tr",[r("th",{staticClass:"text-left"},[r("span",[e._v("Tipo")])]),r("th",{staticClass:"text-left"},[r("span",[e._v("Nombre")])]),r("th",{staticClass:"text-left"},[r("span",[e._v("Marca")])])])]),r("tbody",[r("tr",[r("td",[e._v(e._s(e.productById(e.filters.product).typeId?e.productById(e.filters.product).typeId.name:"Sin tipo"))]),r("td",[e._v(e._s(e.productById(e.filters.product).name))]),r("td",[e._v(e._s(e.productById(e.filters.product).brandId?e.productById(e.filters.product).brandId.name:"Sin marca"))]),r("td",[r("v-btn",{attrs:{color:"error",small:""},on:{click:function(t){e.filters.product=null}}},[e._v("Limpiar")])],1)])])]},proxy:!0}],null,!1,1458898029)}):e._e()],1)],1)],1),r("v-row",{attrs:{justify:"center"}},[r("v-col",{attrs:{cols:"12",sm:"6"}},[r("v-btn",{attrs:{block:"",color:"success"},on:{click:function(t){return e.initialData(1,e.filters)}}},[e._v("Buscar!")])],1)],1),r("v-col",{attrs:{cols:"12",sm:"12"}},[r("p",[r("strong",[e._v("Cantidad de ventas:")]),e._v(" "+e._s(e.$store.state.salesModule.total)+" ")])]),r("div",{staticClass:"text-center pt-2"},[r("v-pagination",{attrs:{length:e.totalPages},on:{input:function(t){return e.initialData(e.page,e.filters)}},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}})],1),r("v-data-table",{staticClass:"elevation-1",attrs:{loading:!e.isDataReady,headers:e.headers,items:e.sales,options:e.pagination,"items-per-page":500,"hide-default-footer":"","server-items-length":e.totalItems},on:{"update:options":function(t){e.pagination=t}},scopedSlots:e._u([{key:"no-data",fn:function(){return[r("v-alert",{attrs:{type:"error",value:!0}},[e._v("Aún no cuentas con un historial de ventas")])]},proxy:!0},{key:"item.userId",fn:function(t){var r=t.item;return[e._v(e._s(r.userId.email))]}},{key:"item.products",fn:function(t){var a=t.item;return[r("ul",e._l(a.products,(function(t){return r("li",{key:t._id},[e._v(e._s(t.productId?t.productId.name:"Producto eliminado")+" ("+e._s(t.qty)+" x S/."+e._s(t.salePrice)+")")])})),0)]}},{key:"item.amount",fn:function(t){var a=t.item;return[r("span",{staticClass:"ganancia"},[e._v("S/."+e._s(e.totalRevenue(a.products)))])]}},{key:"item.commerce",fn:function(t){var a=t.item;return[r("span",[e._v(e._s(a.commerce))])]}},{key:"item.date",fn:function(t){var a=t.item;return[r("div",[r("v-text-field",{directives:[{name:"show",rawName:"v-show",value:e.editMode&&a._id==e.editedIndex,expression:"editMode && item._id==editedIndex"}],staticClass:"mt-4",attrs:{outlined:"",dense:"","prepend-icon":"event",type:"date"},model:{value:e.editedDate,callback:function(t){e.editedDate=t},expression:"editedDate"}}),r("span",{directives:[{name:"show",rawName:"v-show",value:!e.editMode||a._id!=e.editedIndex,expression:"!editMode || item._id!=editedIndex"}]},[e._v(e._s(e._f("formatDate")(a.date)))]),r("v-chip",{directives:[{name:"show",rawName:"v-show",value:!!a.products[0]&&a.products[0].history,expression:"item.products[0]?item.products[0].history:false"}],staticClass:"ma-2",attrs:{color:"info",small:""}},[e._v("Histórico")])],1)]}},{key:"item.actions",fn:function(t){var a=t.item;return[r("v-btn",{directives:[{name:"show",rawName:"v-show",value:!e.editMode||a._id!=e.editedIndex,expression:"!editMode || item._id!=editedIndex"}],staticClass:"mr-2 my-2",attrs:{small:"",color:"info"},on:{click:function(t){e.editMode=!0,e.editedIndex=a._id,e.editedDate=new Date(a.date).toISOString().substr(0,10)}}},[e._v("Editar")]),r("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.editMode&&a._id==e.editedIndex,expression:"editMode && item._id==editedIndex"}],staticClass:"mr-2 my-2",attrs:{small:"",color:"success"},on:{click:function(t){e.saveSale(a),e.editMode=!1}}},[e._v("Guardar")]),r("v-btn",{staticClass:"mb-2 my-2",attrs:{small:"",color:"error"},on:{click:function(t){return e.deleteItem(a)}}},[e._v("Eliminar")])]}},{key:"item.createdAt",fn:function(t){var r=t.item;return[e._v(e._s(e._f("formatDate")(r.createdAt)))]}}])}),r("div",{staticClass:"text-center pt-2"},[r("v-pagination",{attrs:{length:e.totalPages},on:{input:function(t){return e.initialData(e.page,e.filters)}},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}})],1)]},proxy:!0}])})},n=[],o=(r("c975"),r("13d5"),r("a434"),r("b680"),r("b85c")),i=(r("96cf"),r("1da1")),s=r("5530"),c=r("b166"),l=r("2f62"),d=r("fa7d"),u=r("d101"),f={components:{products:u["a"]},filters:{formatDate:function(e){return Object(c["a"])(new Date(e),"dd/MM/yyyy")}},data:function(){return{filters:{startDate:null,endDate:null,commerce:null,product:null},editedDate:null,editedIndex:null,editMode:!1,page:1,pageCount:0,itemsPerPage:10,isDataReady:!1,selectedOrder:0,pagination:{},search:"",dialog:!1,headers:[{text:"Negocio",value:"commerce"},{text:"Fecha de venta",value:"date"},{text:"Vendedor",value:"userId"},{text:"Productos vendidos",value:"products"},{text:"Beneficio",value:"amount"},{text:"Acciones",value:"actions"}],sales:[],orderDetails:[]}},computed:Object(s["a"])(Object(s["a"])({totalItems:function(){return this.$store.state.salesModule.totalSales},totalPages:function(){return this.$store.state.salesModule.totalPages}},Object(l["b"])({productById:"productsModule/productById"})),{},{commerce:function(){return this.$store.state.commerce}}),created:function(){this.initialData()},methods:{initialData:function(e,t){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r.$store.dispatch("loadingModule/showLoading"),e=e||1,a.t0=r,a.next=6,r.$store.dispatch("salesModule/listWithProducts",Object(s["a"])(Object(s["a"])({},t),Object(d["a"])({page:e,itemsPerPage:r.$store.state.itemsPerPage})));case 6:for(a.t1=a.sent,r.sales=a.t0.$deepCopy.call(a.t0,a.t1),n=0;n<r.sales.length;n++)for(o=0;o<r.sales[n].products.length;o++)r.sales[n].products[o].productId=r.productById(r.sales[n].products[o].productId);a.next=14;break;case 11:a.prev=11,a.t2=a["catch"](0),console.log("algo salio mal...:",a.t2);case 14:return a.prev=14,r.$store.dispatch("loadingModule/showLoading",!1),a.finish(14);case 17:r.isDataReady=!0;case 18:case"end":return a.stop()}}),a,null,[[0,11,14,17]])})))()},saveSale:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=new Date(t.editedDate),a=new Date(a.getTime()- -6e4*a.getTimezoneOffset()),e.date=a,r.next=5,t.$store.dispatch("salesModule/update",{id:e._id,data:{commerce:e.commerce,date:a}});case 5:case"end":return r.stop()}}),r)})))()},totalRevenue:function(e){return e?e.reduce((function(e,t){return e+t.salePrice*t.qty}),0).toFixed(2):"S/.0"},deleteItem:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var a,n,i,s,c,l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=t.sales.indexOf(e),n=t.sales[a]._id,i=t.sales[a].products,r.next=5,t.$confirm("¿Seguro que deseas eliminar esta venta? Se sumará el stock a los productos del detalle");case 5:if(!r.sent){r.next=21;break}return r.prev=6,t.$store.dispatch("loadingModule/showLoading"),r.next=10,t.$store.dispatch("salesModule/delete",n);case 10:s=Object(o["a"])(i);try{for(s.s();!(c=s.n()).done;)l=c.value,console.log("este es el history: ",l.history),l.history||t.$store.commit("productsModule/updateStock",{productId:l.productId._id,qty:l.qty})}catch(d){s.e(d)}finally{s.f()}t.sales.splice(a,1),r.next=18;break;case 15:r.prev=15,r.t0=r["catch"](6),console.log(r.t0);case 18:return r.prev=18,t.$store.dispatch("loadingModule/showLoading",!1),r.finish(18);case 21:case"end":return r.stop()}}),r,null,[[6,15,18,21]])})))()}}},v=f,p=r("2877"),m=r("6544"),h=r.n(m),g=r("0798"),b=r("8336"),y=r("b0af"),x=r("99d9"),w=r("cc20"),_=r("62ad"),S=r("a523"),I=r("8fea"),k=r("169a"),D=r("ce7e"),C=r("132d"),M=r("891e"),A=r("0fd9"),$=r("b974"),O=r("1f4f"),V=r("2fa4"),j=r("8654"),P=r("71d9"),R=r("2a7f"),N=r("3a2f"),T=Object(p["a"])(v,a,n,!1,null,"49b5a50c",null);t["default"]=T.exports;h()(T,{VAlert:g["a"],VBtn:b["a"],VCard:y["a"],VCardActions:x["b"],VChip:w["a"],VCol:_["a"],VContainer:S["a"],VDataTable:I["a"],VDialog:k["a"],VDivider:D["a"],VIcon:C["a"],VPagination:M["a"],VRow:A["a"],VSelect:$["a"],VSimpleTable:O["a"],VSpacer:V["a"],VTextField:j["a"],VToolbar:P["a"],VToolbarTitle:R["c"],VTooltip:N["a"]})},"1148d":function(e,t,r){"use strict";var a=r("a691"),n=r("1d80");e.exports="".repeat||function(e){var t=String(n(this)),r="",o=a(e);if(o<0||o==1/0)throw RangeError("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(r+=t);return r}},"13d5":function(e,t,r){"use strict";var a=r("23e7"),n=r("d58f").left,o=r("a640"),i=r("ae40"),s=o("reduce"),c=i("reduce",{1:0});a({target:"Array",proto:!0,forced:!s||!c},{reduce:function(e){return n(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},"3ca3":function(e,t,r){"use strict";var a=r("6547").charAt,n=r("69f3"),o=r("7dd0"),i="String Iterator",s=n.set,c=n.getterFor(i);o(String,"String",(function(e){s(this,{type:i,string:String(e),index:0})}),(function(){var e,t=c(this),r=t.string,n=t.index;return n>=r.length?{value:void 0,done:!0}:(e=a(r,n),t.index+=e.length,{value:e,done:!1})}))},"408a":function(e,t,r){var a=r("c6b6");e.exports=function(e){if("number"!=typeof e&&"Number"!=a(e))throw TypeError("Incorrect invocation");return+e}},"4df4":function(e,t,r){"use strict";var a=r("0366"),n=r("7b0b"),o=r("9bdd"),i=r("e95a"),s=r("50c4"),c=r("8418"),l=r("35a1");e.exports=function(e){var t,r,d,u,f,v,p=n(e),m="function"==typeof this?this:Array,h=arguments.length,g=h>1?arguments[1]:void 0,b=void 0!==g,y=l(p),x=0;if(b&&(g=a(g,h>2?arguments[2]:void 0,2)),void 0==y||m==Array&&i(y))for(t=s(p.length),r=new m(t);t>x;x++)v=b?g(p[x],x):p[x],c(r,x,v);else for(u=y.call(p),f=u.next,r=new m;!(d=f.call(u)).done;x++)v=b?o(u,g,[d.value,x],!0):d.value,c(r,x,v);return r.length=x,r}},a630:function(e,t,r){var a=r("23e7"),n=r("4df4"),o=r("1c7e"),i=!o((function(e){Array.from(e)}));a({target:"Array",stat:!0,forced:i},{from:n})},b680:function(e,t,r){"use strict";var a=r("23e7"),n=r("a691"),o=r("408a"),i=r("1148d"),s=r("d039"),c=1..toFixed,l=Math.floor,d=function(e,t,r){return 0===t?r:t%2===1?d(e,t-1,r*e):d(e*e,t/2,r)},u=function(e){var t=0,r=e;while(r>=4096)t+=12,r/=4096;while(r>=2)t+=1,r/=2;return t},f=c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!s((function(){c.call({})}));a({target:"Number",proto:!0,forced:f},{toFixed:function(e){var t,r,a,s,c=o(this),f=n(e),v=[0,0,0,0,0,0],p="",m="0",h=function(e,t){var r=-1,a=t;while(++r<6)a+=e*v[r],v[r]=a%1e7,a=l(a/1e7)},g=function(e){var t=6,r=0;while(--t>=0)r+=v[t],v[t]=l(r/e),r=r%e*1e7},b=function(){var e=6,t="";while(--e>=0)if(""!==t||0===e||0!==v[e]){var r=String(v[e]);t=""===t?r:t+i.call("0",7-r.length)+r}return t};if(f<0||f>20)throw RangeError("Incorrect fraction digits");if(c!=c)return"NaN";if(c<=-1e21||c>=1e21)return String(c);if(c<0&&(p="-",c=-c),c>1e-21)if(t=u(c*d(2,69,1))-69,r=t<0?c*d(2,-t,1):c/d(2,t,1),r*=4503599627370496,t=52-t,t>0){h(0,r),a=f;while(a>=7)h(1e7,0),a-=7;h(d(10,a,1),0),a=t-1;while(a>=23)g(1<<23),a-=23;g(1<<a),h(1,1),g(2),m=b()}else h(0,r),h(1<<-t,0),m=b()+i.call("0",f);return f>0?(s=m.length,m=p+(s<=f?"0."+i.call("0",f-s)+m:m.slice(0,s-f)+"."+m.slice(s-f))):m=p+m,m}})},b85c:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));r("a4d3"),r("e01a"),r("d28b"),r("d3b7"),r("3ca3"),r("ddb0"),r("a630"),r("fb6a"),r("b0c0"),r("25f0");function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function n(e,t){if(e){if("string"===typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}function o(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=n(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==r["return"]||r["return"]()}finally{if(c)throw i}}}}},d28b:function(e,t,r){var a=r("746f");a("iterator")},d58f:function(e,t,r){var a=r("1c0b"),n=r("7b0b"),o=r("44ad"),i=r("50c4"),s=function(e){return function(t,r,s,c){a(r);var l=n(t),d=o(l),u=i(l.length),f=e?u-1:0,v=e?-1:1;if(s<2)while(1){if(f in d){c=d[f],f+=v;break}if(f+=v,e?f<0:u<=f)throw TypeError("Reduce of empty array with no initial value")}for(;e?f>=0:u>f;f+=v)f in d&&(c=r(c,d[f],f,l));return c}};e.exports={left:s(!1),right:s(!0)}},e01a:function(e,t,r){"use strict";var a=r("23e7"),n=r("83ab"),o=r("da84"),i=r("5135"),s=r("861d"),c=r("9bf2").f,l=r("e893"),d=o.Symbol;if(n&&"function"==typeof d&&(!("description"in d.prototype)||void 0!==d().description)){var u={},f=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof f?new d(e):void 0===e?d():d(e);return""===e&&(u[t]=!0),t};l(f,d);var v=f.prototype=d.prototype;v.constructor=f;var p=v.toString,m="Symbol(test)"==String(d("test")),h=/^Symbol\((.*)\)[^)]+$/;c(v,"description",{configurable:!0,get:function(){var e=s(this)?this.valueOf():this,t=p.call(e);if(i(u,e))return"";var r=m?t.slice(7,-1):t.replace(h,"$1");return""===r?void 0:r}}),a({global:!0,forced:!0},{Symbol:f})}},fb6a:function(e,t,r){"use strict";var a=r("23e7"),n=r("861d"),o=r("e8b5"),i=r("23cb"),s=r("50c4"),c=r("fc6a"),l=r("8418"),d=r("b622"),u=r("1dde"),f=r("ae40"),v=u("slice"),p=f("slice",{ACCESSORS:!0,0:0,1:2}),m=d("species"),h=[].slice,g=Math.max;a({target:"Array",proto:!0,forced:!v||!p},{slice:function(e,t){var r,a,d,u=c(this),f=s(u.length),v=i(e,f),p=i(void 0===t?f:t,f);if(o(u)&&(r=u.constructor,"function"!=typeof r||r!==Array&&!o(r.prototype)?n(r)&&(r=r[m],null===r&&(r=void 0)):r=void 0,r===Array||void 0===r))return h.call(u,v,p);for(a=new(void 0===r?Array:r)(g(p-v,0)),d=0;v<p;v++,d++)v in u&&l(a,d,u[v]);return a.length=d,a}})}}]);
//# sourceMappingURL=chunk-40a42053.528d874b.js.map