(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-78ada07d"],{1148:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("custom-card",{attrs:{title:"Historial de ventas",icon:"mdi-format-list-checks"},scopedSlots:t._u([{key:"content",fn:function(){return[a("v-col",{attrs:{cols:"12",sm:"12"}},[a("p",[a("strong",[t._v("Total de ventas:")]),t._v(" "+t._s(t.$store.getters.getTotalOrders)+" ")])]),a("v-data-table",{attrs:{loading:!t.isDataReady,"loading-text":"Cargando datos","hide-default-footer":"",headers:t.headers,items:t.orders,page:t.page,"items-per-page":t.itemsPerPage},on:{"page-count":function(e){t.pageCount=e},"update:page":function(e){t.page=e}},scopedSlots:t._u([{key:"no-data",fn:function(){return[a("v-alert",{attrs:{type:"error",value:!0}},[t._v("Aún no cuentas con un historial de ventas")])]},proxy:!0},{key:"item.userId",fn:function(){return[t._v("Administrador")]},proxy:!0},{key:"item.actions",fn:function(e){var r=e.item;return[a("v-btn",{staticClass:"mr-3",attrs:{small:"",color:"secondary"},on:{click:function(e){e.stopPropagation(),t.dialog=!0,t.showOrderDetail(r)}}},[t._v("Ver detalle")]),a("v-btn",{attrs:{small:"",color:"error"},on:{click:function(e){return t.deleteItem(r)}}},[t._v("Eliminar")])]}},{key:"item.createdAt",fn:function(e){var a=e.item;return[t._v(t._s(t._f("formatDate")(a.createdAt)))]}}])}),a("div",{staticClass:"text-center pt-2"},[a("v-pagination",{attrs:{length:t.pageCount},model:{value:t.page,callback:function(e){t.page=e},expression:"page"}})],1),a("v-dialog",{attrs:{width:"500"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[a("v-card",[a("v-toolbar",{attrs:{color:"secondary",dark:""}},[a("v-toolbar-title",[t._v("Detalle de venta")])],1),a("v-container",[a("p",[a("strong",[t._v("ID de la venta:")]),t._v(" "+t._s(t.orders.length>0?t.orders[t.selectedOrder]._id:"")+" ")]),a("p",[a("strong",[t._v("Usuario:")]),t._v(" Administrador ")]),a("p",[a("strong",[t._v("Detalle de productos:")])]),a("v-simple-table",{scopedSlots:t._u([{key:"default",fn:function(){return[a("thead",[a("tr",[a("th",{staticClass:"text-left"},[t._v("Producto")]),a("th",{staticClass:"text-left"},[t._v("Precio")]),a("th",{staticClass:"text-left"},[t._v("Cantidad")]),a("th",{staticClass:"text-left"},[t._v("Subtotal")])])]),a("tbody",t._l(t.orderDetails,(function(e){return a("tr",{key:e._id},[a("td",[t._v(t._s(t.$store.getters.getProductById(e.productId)))]),a("td",[t._v("S/. "+t._s(e.price))]),a("td",[t._v(t._s(e.qty))]),a("td",[t._v("S/. "+t._s(e.price*e.qty))])])})),0)]},proxy:!0}])}),a("v-row",{staticClass:"mr-3",attrs:{justify:"end"}},[a("v-card",{staticClass:"pa-3",attrs:{outlined:"",color:"light-green lighten-5"}},[a("strong",{staticClass:"mr-3"},[t._v("Total:")]),t._v(" "),a("span",{staticClass:"total"},[t._v("S/."+t._s(t.getTotal))])])],1)],1),a("v-divider"),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"primary",text:""},on:{click:function(e){t.dialog=!1,t.clearOrderDetail()}}},[t._v("De acuerdo")])],1)],1)],1)]},proxy:!0}])})},o=[],n=(a("4160"),a("c975"),a("13d5"),a("a434"),a("159b"),a("96cf"),a("1da1")),s=a("bc3a"),i=a.n(s),c=a("b166"),d=a("5952"),l={filters:{formatDate:function(t){return Object(c["a"])(new Date(t),"dd/MM/yyyy")}},data:function(){return{page:1,pageCount:0,itemsPerPage:10,isDataReady:!1,selectedOrder:0,search:"",dialog:!1,headers:[{text:"ID de venta",value:"_id"},{text:"Usuario",value:"userId"},{text:"Fecha",value:"createdAt"},{text:"Acciones",value:"actions"}],orders:[],orderDetails:[]}},computed:{formTitle:function(){return"Editar producto"},brands:function(){return this.$store.getters.getBrands},types:function(){return this.$store.getters.getTypes},colors:function(){return this.$store.getters.getColors},getTotal:function(){return this.orderDetails.reduce((function(t,e){return t+e.price*e.qty}),0)}},created:function(){this.initialData()},methods:{initialData:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("loadInitialOrders");case 2:t.orders=e.sent,t.isDataReady=!0;case 4:case"end":return e.stop()}}),e)})))()},showOrderDetail:function(t){var e=this;this.selectedOrder=this.orders.indexOf(t);var a=this.orders[this.selectedOrder]._id;i.a.get("/api/order-details/list",{params:{orderId:a}}).then((function(t){console.log(t),t.data.ok&&(e.orderDetails=t.data.payload)})).catch((function(t){console.error(t)}))},clearOrderDetail:function(){this.orderDetails=[]},deleteItem:function(t){var e=this,a=this.orders.indexOf(t),r=this.orders[a]._id;confirm("¿Seguro que deseas eliminar esta venta? Se sumará el stock a los productos del detalle")&&(this.updateStoreStock(r),this.$store.dispatch("showOverlay",!0),Object(d["a"])("delete","/api/orders/delete/"+r,null,(function(){e.$store.dispatch("showOverlay",!1),e.orders.splice(a,1)})))},updateStoreStock:function(t){var e=this;i.a.get("/api/order-details/list",{params:{orderId:t}}).then((function(t){if(console.log(t),t.data.ok){var a=t.data.payload;a.forEach((function(t){e.$store.dispatch("updateStock",{type:"order",productId:t.productId,qty:-parseInt(t.qty)})}))}})).catch((function(t){console.error(t)}))}}},u=l,f=a("2877"),p=a("6544"),v=a.n(p),h=a("0798"),g=a("8336"),m=a("b0af"),_=a("99d9"),y=a("62ad"),b=a("a523"),x=a("8fea"),k=a("169a"),O=a("ce7e"),D=a("891e"),w=a("0fd9"),C=a("1f4f"),S=a("2fa4"),V=a("71d9"),A=a("2a7f"),I=Object(f["a"])(u,r,o,!1,null,"7cf7ac87",null);e["default"]=I.exports;v()(I,{VAlert:h["a"],VBtn:g["a"],VCard:m["a"],VCardActions:_["b"],VCol:y["a"],VContainer:b["a"],VDataTable:x["a"],VDialog:k["a"],VDivider:O["a"],VPagination:D["a"],VRow:w["a"],VSimpleTable:C["a"],VSpacer:S["a"],VToolbar:V["a"],VToolbarTitle:A["c"]})},"13d5":function(t,e,a){"use strict";var r=a("23e7"),o=a("d58f").left,n=a("a640"),s=a("ae40"),i=n("reduce"),c=s("reduce",{1:0});r({target:"Array",proto:!0,forced:!i||!c},{reduce:function(t){return o(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}})},5952:function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));var r=a("4360"),o=a("bc3a"),n=a.n(o),s=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};n.a[t](e,a).then((function(t){console.log(t.data),r["a"].dispatch("showSnackbar",{text:t.data.message,color:"success"}),t.data.ok&&o(null,t.data.payload)})).catch((function(t){console.log("hubo un error en la llamada a la api"),"ECONNABORTED"===t.code&&(console.log("se excedio el tiempo limite"),r["a"].dispatch("showSnackbar",{text:"Algo salió mal",color:"error"})),r["a"].dispatch("showSnackbar",{text:t.response.data.message,color:"error"}),console.error(t),o(t)}))}},c975:function(t,e,a){"use strict";var r=a("23e7"),o=a("4d64").indexOf,n=a("a640"),s=a("ae40"),i=[].indexOf,c=!!i&&1/[1].indexOf(1,-0)<0,d=n("indexOf"),l=s("indexOf",{ACCESSORS:!0,1:0});r({target:"Array",proto:!0,forced:c||!d||!l},{indexOf:function(t){return c?i.apply(this,arguments)||0:o(this,t,arguments.length>1?arguments[1]:void 0)}})},d58f:function(t,e,a){var r=a("1c0b"),o=a("7b0b"),n=a("44ad"),s=a("50c4"),i=function(t){return function(e,a,i,c){r(a);var d=o(e),l=n(d),u=s(d.length),f=t?u-1:0,p=t?-1:1;if(i<2)while(1){if(f in l){c=l[f],f+=p;break}if(f+=p,t?f<0:u<=f)throw TypeError("Reduce of empty array with no initial value")}for(;t?f>=0:u>f;f+=p)f in l&&(c=a(c,l[f],f,d));return c}};t.exports={left:i(!1),right:i(!0)}}}]);
//# sourceMappingURL=chunk-78ada07d.9cbed4f1.js.map