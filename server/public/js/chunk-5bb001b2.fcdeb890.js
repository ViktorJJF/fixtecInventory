(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5bb001b2"],{"0114":function(t,e,r){},"086e":function(t,e,r){"use strict";var a=r("0114"),o=r.n(a);o.a},"13d5":function(t,e,r){"use strict";var a=r("23e7"),o=r("d58f").left,n=r("a640"),c=r("ae40"),s=n("reduce"),i=c("reduce",{1:0});a({target:"Array",proto:!0,forced:!s||!i},{reduce:function(t){return o(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}})},af81:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("custom-card",{attrs:{title:"Realizar venta",icon:"mdi-plus"},scopedSlots:t._u([{key:"content",fn:function(){return[r("v-container",[r("v-row",{attrs:{align:"center"}},[r("p",{staticClass:"body-1 font-weight-bold d-inline mx-3"},[t._v("Fecha:")]),r("v-menu",{ref:"menu",staticClass:"d-inline",attrs:{"close-on-content-click":!1,"return-value":t.date,transition:"scale-transition","offset-y":""},on:{"update:returnValue":function(e){t.date=e},"update:return-value":function(e){t.date=e}},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on,o=e.attrs;return[r("v-text-field",t._g(t._b({staticClass:"date-width",attrs:{"prepend-inner-icon":"event",readonly:"",outlined:"",dense:""},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}},"v-text-field",o,!1),a))]}}]),model:{value:t.menu,callback:function(e){t.menu=e},expression:"menu"}},[r("v-date-picker",{attrs:{"no-title":"",scrollable:""},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}},[r("v-spacer"),r("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){t.menu=!1}}},[t._v("Cancel")]),r("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){return t.$refs.menu.save(t.date)}}},[t._v("OK")])],1)],1)],1),r("v-btn",{staticClass:"my-3",attrs:{tile:"",color:"primary"},on:{click:t.addOrder}},[r("v-icon",{attrs:{left:""}},[t._v("search")]),t._v("Búsqueda ")],1),r("v-text-field",{staticClass:"search-field mr-3",attrs:{placeholder:"Buscar por nombre de producto",height:"20px",name:"name",id:"id",outlined:"",dense:""}}),r("v-btn",{attrs:{outlined:"",color:"primary",to:{name:"orderHistory"}}},[r("v-icon",{attrs:{left:""}},[t._v("mdi-format-list-checks")]),t._v("Ver historial ")],1),r("v-alert",{attrs:{text:"",type:"error",value:t.validateError}},[t._v("Es necesario agregar al menos 01 producto")]),r("v-simple-table",{scopedSlots:t._u([{key:"default",fn:function(){return[r("thead",[r("tr",[r("th",{staticClass:"text-left"},[t._v("Producto")]),r("th",{staticClass:"text-left"},[t._v("Cantidad")]),r("th",{staticClass:"text-left"},[t._v("Precio")]),r("th",{staticClass:"text-left"},[t._v("Subtotal")]),r("th",{staticClass:"text-left"},[t._v("Eliminar producto")])])]),r("tbody",t._l(t.order,(function(e,a){return r("tr",{key:a},[r("td",[r("v-container",[r("v-select",{attrs:{placeholder:"Seleccione el producto",suffix:"Stock:"+t.$store.getters.getproductStock(e.productId),items:t.products,"item-text":"model","item-value":"_id"},on:{change:function(r){t.order[a].price=t.getProductPrice(e.productId)}},model:{value:e.productId,callback:function(r){t.$set(e,"productId",r)},expression:"product.productId"}})],1)],1),r("td",[r("v-text-field",{attrs:{type:"number"},model:{value:e.qty,callback:function(r){t.$set(e,"qty",r)},expression:"product.qty"}})],1),r("td",[t._v("S/."+t._s(e.price))]),r("td",[t._v("S/."+t._s(e.price*e.qty))]),r("td",[r("v-btn",{attrs:{small:"",color:"error"},on:{click:function(e){return t.deleteOrder(a)}}},[t._v("Eliminar")])],1)])})),0)]},proxy:!0}])}),r("v-alert",{directives:[{name:"show",rawName:"v-show",value:0==t.order.length,expression:"order.length==0"}],staticClass:"my-5",attrs:{type:"warning",text:""}},[t._v("Aún no agregaste productos a esta venta")]),r("v-row",{staticClass:"mr-3",attrs:{justify:"end"}},[r("v-card",{staticClass:"pa-3",attrs:{dark:"",outlined:"",color:"info"}},[r("strong",{staticClass:"text--white"},[t._v("Total:")]),t._v(" "),r("span",{staticClass:"total"},[t._v("S/."+t._s(t.getTotal))])])],1),r("v-alert",{attrs:{text:"",type:"error",value:t.stockError}},[t._v("La cantidad vendida no puede superar el stock")]),r("v-btn",{attrs:{loading:t.loadingButton,color:"success"},on:{click:t.saveOrder}},[t._v("Guardar orden")])],1)]},proxy:!0}])})},o=[],n=(r("4160"),r("13d5"),r("a434"),r("d3b7"),r("159b"),r("96cf"),r("1da1")),c=r("bc3a"),s=r.n(c),i={data:function(){return{date:(new Date).toISOString().substr(0,10),menu:!1,order:[],total:0,loadingButton:!1,validateError:!1,stockError:!1}},methods:{deleteOrder:function(t){this.order.splice(t,1)},addOrder:function(){this.order.push({productId:"",qty:1,price:0})},getProductPrice:function(t){return this.$store.getters.getProductPrice(t)},validateForm:function(){var t=this,e=this.order,r=!1;return e.forEach((function(e){var a=t.$store.getters.getproductStock(e.productId);if(e.qty>a)return r=!0})),!0===r?(this.stockError=!0,!1):0===this.order.length?(this.validateError=!0,!1):(this.stockError=!1,this.validateError=!1,r=!1,!0)},saveOrder:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.validateForm()){e.next=2;break}return e.abrupt("return",!1);case 2:return t.loadingButton=!0,t.$store.dispatch("showOverlay",!0),e.next=6,t.apiCalls();case 6:t.updateStoreStock(),t.$store.dispatch("showSnackbar",{text:"Venta agregada con éxito",color:"success"}),t.loadingButton=!1,t.$store.dispatch("showOverlay",!1),t.order=[];case 11:case"end":return e.stop()}}),e)})))()},updateStoreStock:function(){var t=this;this.order.forEach((function(e){t.$store.dispatch("updateStock",{type:"order",productId:e.productId,qty:parseInt(e.qty)})}))},apiCalls:function(){var t=this;return new Promise((function(e,r){s.a.post("/api/orders/create",{userId:t.$store.getters.getUserId}).then((function(a){t.$store.dispatch("addOrder",a.data.payload);var o=a.data.payload._id;t.order.forEach((function(t){s.a.post("/api/order-details/create",{orderId:o,productId:t.productId,price:t.price,qty:parseInt(t.qty)}).then((function(t){console.log(t),e()})).catch((function(t){console.error(t),r(t)}))}))})).catch((function(t){console.error(t)}))}))}},computed:{products:function(){return this.$store.getters.getProducts},getTotal:function(){var t=this;return this.order.reduce((function(e,r){return e+t.getProductPrice(r.productId)*r.qty}),0)}}},d=i,u=(r("086e"),r("2877")),l=r("6544"),p=r.n(l),f=r("0798"),v=r("8336"),h=r("b0af"),m=r("a523"),g=r("2e4b"),b=r("132d"),y=r("e449"),k=r("0fd9"),x=r("b974"),_=r("1f4f"),w=r("2fa4"),S=r("8654"),C=Object(u["a"])(d,a,o,!1,null,"3a20c00c",null);e["default"]=C.exports;p()(C,{VAlert:f["a"],VBtn:v["a"],VCard:h["a"],VContainer:m["a"],VDatePicker:g["a"],VIcon:b["a"],VMenu:y["a"],VRow:k["a"],VSelect:x["a"],VSimpleTable:_["a"],VSpacer:w["a"],VTextField:S["a"]})},d58f:function(t,e,r){var a=r("1c0b"),o=r("7b0b"),n=r("44ad"),c=r("50c4"),s=function(t){return function(e,r,s,i){a(r);var d=o(e),u=n(d),l=c(d.length),p=t?l-1:0,f=t?-1:1;if(s<2)while(1){if(p in u){i=u[p],p+=f;break}if(p+=f,t?p<0:l<=p)throw TypeError("Reduce of empty array with no initial value")}for(;t?p>=0:l>p;p+=f)p in u&&(i=r(i,u[p],p,d));return i}};t.exports={left:s(!1),right:s(!0)}}}]);
//# sourceMappingURL=chunk-5bb001b2.fcdeb890.js.map