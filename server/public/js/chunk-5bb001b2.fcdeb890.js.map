{"version":3,"sources":["webpack:///./src/views/drawerPages/addSale.vue?0b18","webpack:///./node_modules/core-js/modules/es.array.reduce.js","webpack:///./src/views/drawerPages/addSale.vue?4d38","webpack:///src/views/drawerPages/addSale.vue","webpack:///./src/views/drawerPages/addSale.vue?2a18","webpack:///./src/views/drawerPages/addSale.vue?ce08","webpack:///./node_modules/core-js/internals/array-reduce.js"],"names":["$","$reduce","left","arrayMethodIsStrict","arrayMethodUsesToLength","STRICT_METHOD","USES_TO_LENGTH","1","target","proto","forced","reduce","callbackfn","this","arguments","length","undefined","render","_vm","_h","$createElement","_c","_self","attrs","scopedSlots","_u","key","fn","staticClass","_v","ref","date","on","$event","_g","_b","model","value","callback","$$v","expression","menu","$refs","save","addOrder","name","validateError","_l","product","orderIndex","$store","getters","getproductStock","productId","products","order","price","getProductPrice","$set","_s","qty","deleteOrder","proxy","directives","rawName","getTotal","stockError","loadingButton","saveOrder","staticRenderFns","data","Date","toISOString","substr","total","methods","splice","push","validateForm","forEach","stock","stockSentinel","updateStoreStock","type","detail","parseInt","apiCalls","Promise","computed","getProducts","component","VAlert","VBtn","VCard","VContainer","VDatePicker","VIcon","VMenu","VRow","VSelect","VSimpleTable","VSpacer","VTextField","aFunction","toObject","IndexedObject","toLength","createMethod","IS_RIGHT","that","argumentsLength","memo","O","self","index","i","TypeError","module","exports","right"],"mappings":"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","file":"js/chunk-5bb001b2.fcdeb890.js","sourcesContent":["import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./addSale.vue?vue&type=style&index=0&id=3a20c00c&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./addSale.vue?vue&type=style&index=0&id=3a20c00c&lang=scss&scoped=true&\"","'use strict';\nvar $ = require('../internals/export');\nvar $reduce = require('../internals/array-reduce').left;\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar STRICT_METHOD = arrayMethodIsStrict('reduce');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('reduce', { 1: 0 });\n\n// `Array.prototype.reduce` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.reduce\n$({ target: 'Array', proto: true, forced: !STRICT_METHOD || !USES_TO_LENGTH }, {\n  reduce: function reduce(callbackfn /* , initialValue */) {\n    return $reduce(this, callbackfn, arguments.length, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('custom-card',{attrs:{\"title\":\"Realizar venta\",\"icon\":\"mdi-plus\"},scopedSlots:_vm._u([{key:\"content\",fn:function(){return [_c('v-container',[_c('v-row',{attrs:{\"align\":\"center\"}},[_c('p',{staticClass:\"body-1 font-weight-bold d-inline mx-3\"},[_vm._v(\"Fecha:\")]),_c('v-menu',{ref:\"menu\",staticClass:\"d-inline\",attrs:{\"close-on-content-click\":false,\"return-value\":_vm.date,\"transition\":\"scale-transition\",\"offset-y\":\"\"},on:{\"update:returnValue\":function($event){_vm.date=$event},\"update:return-value\":function($event){_vm.date=$event}},scopedSlots:_vm._u([{key:\"activator\",fn:function(ref){\nvar on = ref.on;\nvar attrs = ref.attrs;\nreturn [_c('v-text-field',_vm._g(_vm._b({staticClass:\"date-width\",attrs:{\"prepend-inner-icon\":\"event\",\"readonly\":\"\",\"outlined\":\"\",\"dense\":\"\"},model:{value:(_vm.date),callback:function ($$v) {_vm.date=$$v},expression:\"date\"}},'v-text-field',attrs,false),on))]}}]),model:{value:(_vm.menu),callback:function ($$v) {_vm.menu=$$v},expression:\"menu\"}},[_c('v-date-picker',{attrs:{\"no-title\":\"\",\"scrollable\":\"\"},model:{value:(_vm.date),callback:function ($$v) {_vm.date=$$v},expression:\"date\"}},[_c('v-spacer'),_c('v-btn',{attrs:{\"text\":\"\",\"color\":\"primary\"},on:{\"click\":function($event){_vm.menu = false}}},[_vm._v(\"Cancel\")]),_c('v-btn',{attrs:{\"text\":\"\",\"color\":\"primary\"},on:{\"click\":function($event){return _vm.$refs.menu.save(_vm.date)}}},[_vm._v(\"OK\")])],1)],1)],1),_c('v-btn',{staticClass:\"my-3\",attrs:{\"tile\":\"\",\"color\":\"primary\"},on:{\"click\":_vm.addOrder}},[_c('v-icon',{attrs:{\"left\":\"\"}},[_vm._v(\"search\")]),_vm._v(\"Búsqueda \")],1),_c('v-text-field',{staticClass:\"search-field mr-3\",attrs:{\"placeholder\":\"Buscar por nombre de producto\",\"height\":\"20px\",\"name\":\"name\",\"id\":\"id\",\"outlined\":\"\",\"dense\":\"\"}}),_c('v-btn',{attrs:{\"outlined\":\"\",\"color\":\"primary\",\"to\":{name:'orderHistory'}}},[_c('v-icon',{attrs:{\"left\":\"\"}},[_vm._v(\"mdi-format-list-checks\")]),_vm._v(\"Ver historial \")],1),_c('v-alert',{attrs:{\"text\":\"\",\"type\":\"error\",\"value\":_vm.validateError}},[_vm._v(\"Es necesario agregar al menos 01 producto\")]),_c('v-simple-table',{scopedSlots:_vm._u([{key:\"default\",fn:function(){return [_c('thead',[_c('tr',[_c('th',{staticClass:\"text-left\"},[_vm._v(\"Producto\")]),_c('th',{staticClass:\"text-left\"},[_vm._v(\"Cantidad\")]),_c('th',{staticClass:\"text-left\"},[_vm._v(\"Precio\")]),_c('th',{staticClass:\"text-left\"},[_vm._v(\"Subtotal\")]),_c('th',{staticClass:\"text-left\"},[_vm._v(\"Eliminar producto\")])])]),_c('tbody',_vm._l((_vm.order),function(product,orderIndex){return _c('tr',{key:orderIndex},[_c('td',[_c('v-container',[_c('v-select',{attrs:{\"placeholder\":\"Seleccione el producto\",\"suffix\":'Stock:'+ _vm.$store.getters.getproductStock(product.productId),\"items\":_vm.products,\"item-text\":\"model\",\"item-value\":\"_id\"},on:{\"change\":function($event){_vm.order[orderIndex].price=_vm.getProductPrice(product.productId)}},model:{value:(product.productId),callback:function ($$v) {_vm.$set(product, \"productId\", $$v)},expression:\"product.productId\"}})],1)],1),_c('td',[_c('v-text-field',{attrs:{\"type\":\"number\"},model:{value:(product.qty),callback:function ($$v) {_vm.$set(product, \"qty\", $$v)},expression:\"product.qty\"}})],1),_c('td',[_vm._v(\"S/.\"+_vm._s(product.price))]),_c('td',[_vm._v(\"S/.\"+_vm._s(product.price*product.qty))]),_c('td',[_c('v-btn',{attrs:{\"small\":\"\",\"color\":\"error\"},on:{\"click\":function($event){return _vm.deleteOrder(orderIndex)}}},[_vm._v(\"Eliminar\")])],1)])}),0)]},proxy:true}])}),_c('v-alert',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.order.length==0),expression:\"order.length==0\"}],staticClass:\"my-5\",attrs:{\"type\":\"warning\",\"text\":\"\"}},[_vm._v(\"Aún no agregaste productos a esta venta\")]),_c('v-row',{staticClass:\"mr-3\",attrs:{\"justify\":\"end\"}},[_c('v-card',{staticClass:\"pa-3\",attrs:{\"dark\":\"\",\"outlined\":\"\",\"color\":\"info\"}},[_c('strong',{staticClass:\"text--white\"},[_vm._v(\"Total:\")]),_vm._v(\" \"),_c('span',{staticClass:\"total\"},[_vm._v(\"S/.\"+_vm._s(_vm.getTotal))])])],1),_c('v-alert',{attrs:{\"text\":\"\",\"type\":\"error\",\"value\":_vm.stockError}},[_vm._v(\"La cantidad vendida no puede superar el stock\")]),_c('v-btn',{attrs:{\"loading\":_vm.loadingButton,\"color\":\"success\"},on:{\"click\":_vm.saveOrder}},[_vm._v(\"Guardar orden\")])],1)]},proxy:true}])})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <custom-card title=\"Realizar venta\" icon=\"mdi-plus\">\r\n    <template v-slot:content>\r\n      <v-container>\r\n        <v-row align=\"center\">\r\n          <p class=\"body-1 font-weight-bold d-inline mx-3\">Fecha:</p>\r\n          <v-menu\r\n            ref=\"menu\"\r\n            v-model=\"menu\"\r\n            :close-on-content-click=\"false\"\r\n            :return-value.sync=\"date\"\r\n            transition=\"scale-transition\"\r\n            offset-y\r\n            class=\"d-inline\"\r\n          >\r\n            <template v-slot:activator=\"{ on, attrs }\">\r\n              <v-text-field\r\n                class=\"date-width\"\r\n                v-model=\"date\"\r\n                prepend-inner-icon=\"event\"\r\n                readonly\r\n                v-bind=\"attrs\"\r\n                v-on=\"on\"\r\n                outlined\r\n                dense\r\n              ></v-text-field>\r\n            </template>\r\n            <v-date-picker v-model=\"date\" no-title scrollable>\r\n              <v-spacer></v-spacer>\r\n              <v-btn text color=\"primary\" @click=\"menu = false\">Cancel</v-btn>\r\n              <v-btn text color=\"primary\" @click=\"$refs.menu.save(date)\">OK</v-btn>\r\n            </v-date-picker>\r\n          </v-menu>\r\n        </v-row>\r\n        <v-btn tile color=\"primary\" @click=\"addOrder\" class=\"my-3\">\r\n          <v-icon left>search</v-icon>Búsqueda\r\n        </v-btn>\r\n        <v-text-field\r\n          placeholder=\"Buscar por nombre de producto\"\r\n          height=\"20px\"\r\n          name=\"name\"\r\n          id=\"id\"\r\n          outlined\r\n          dense\r\n          class=\"search-field mr-3\"\r\n        ></v-text-field>\r\n        <v-btn outlined color=\"primary\" :to=\"{name:'orderHistory'}\">\r\n          <v-icon left>mdi-format-list-checks</v-icon>Ver historial\r\n        </v-btn>\r\n        <v-alert text type=\"error\" :value=\"validateError\">Es necesario agregar al menos 01 producto</v-alert>\r\n        <v-simple-table>\r\n          <template v-slot:default>\r\n            <thead>\r\n              <tr>\r\n                <th class=\"text-left\">Producto</th>\r\n                <th class=\"text-left\">Cantidad</th>\r\n                <th class=\"text-left\">Precio</th>\r\n                <th class=\"text-left\">Subtotal</th>\r\n                <th class=\"text-left\">Eliminar producto</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              <tr v-for=\"(product,orderIndex) in order\" :key=\"orderIndex\">\r\n                <td>\r\n                  <v-container>\r\n                    <v-select\r\n                      placeholder=\"Seleccione el producto\"\r\n                      :suffix=\"'Stock:'+ $store.getters.getproductStock(product.productId)\"\r\n                      v-model=\"product.productId\"\r\n                      :items=\"products\"\r\n                      item-text=\"model\"\r\n                      item-value=\"_id\"\r\n                      @change=\"order[orderIndex].price=getProductPrice(product.productId)\"\r\n                    ></v-select>\r\n                  </v-container>\r\n                </td>\r\n                <td>\r\n                  <v-text-field v-model=\"product.qty\" type=\"number\"></v-text-field>\r\n                </td>\r\n                <td>S/.{{product.price}}</td>\r\n                <td>S/.{{product.price*product.qty}}</td>\r\n                <td>\r\n                  <v-btn small color=\"error\" @click=\"deleteOrder(orderIndex)\">Eliminar</v-btn>\r\n                </td>\r\n              </tr>\r\n            </tbody>\r\n          </template>\r\n        </v-simple-table>\r\n        <v-alert\r\n          class=\"my-5\"\r\n          v-show=\"order.length==0\"\r\n          type=\"warning\"\r\n          text\r\n        >Aún no agregaste productos a esta venta</v-alert>\r\n        <v-row justify=\"end\" class=\"mr-3\">\r\n          <v-card dark outlined color=\"info\" class=\"pa-3\">\r\n            <strong class=\"text--white\">Total:</strong>\r\n            &nbsp;\r\n            <span class=\"total\">S/.{{getTotal}}</span>\r\n          </v-card>\r\n        </v-row>\r\n        <v-alert text type=\"error\" :value=\"stockError\">La cantidad vendida no puede superar el stock</v-alert>\r\n\r\n        <v-btn :loading=\"loadingButton\" color=\"success\" @click=\"saveOrder\">Guardar orden</v-btn>\r\n      </v-container>\r\n    </template>\r\n  </custom-card>\r\n</template>\r\n\r\n<script>\r\nimport axios from \"axios\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      date: new Date().toISOString().substr(0, 10),\r\n      menu: false,\r\n      order: [],\r\n      total: 0,\r\n      loadingButton: false,\r\n      validateError: false,\r\n      stockError: false,\r\n    };\r\n  },\r\n  methods: {\r\n    deleteOrder(orderIndex) {\r\n      this.order.splice(orderIndex, 1);\r\n    },\r\n    addOrder() {\r\n      this.order.push({\r\n        productId: \"\",\r\n        qty: 1,\r\n        price: 0,\r\n      });\r\n    },\r\n    getProductPrice(model) {\r\n      return this.$store.getters.getProductPrice(model);\r\n    },\r\n    validateForm() {\r\n      let products = this.order;\r\n      let stockSentinel = false;\r\n      products.forEach((product) => {\r\n        let stock = this.$store.getters.getproductStock(product.productId);\r\n        if (product.qty > stock) {\r\n          return (stockSentinel = true);\r\n        }\r\n      });\r\n      if (stockSentinel === true) {\r\n        this.stockError = true;\r\n        return false;\r\n      }\r\n      if (this.order.length === 0) {\r\n        this.validateError = true;\r\n        return false;\r\n      }\r\n      this.stockError = false;\r\n      this.validateError = false;\r\n      stockSentinel = false;\r\n      return true;\r\n    },\r\n    async saveOrder() {\r\n      if (!this.validateForm()) return false;\r\n      this.loadingButton = true;\r\n      this.$store.dispatch(\"showOverlay\", true);\r\n      await this.apiCalls();\r\n      this.updateStoreStock();\r\n      this.$store.dispatch(\"showSnackbar\", {\r\n        text: \"Venta agregada con éxito\",\r\n        color: \"success\",\r\n      });\r\n      this.loadingButton = false;\r\n      this.$store.dispatch(\"showOverlay\", false);\r\n      this.order = [];\r\n    },\r\n    updateStoreStock() {\r\n      this.order.forEach((detail) => {\r\n        this.$store.dispatch(\"updateStock\", {\r\n          type: \"order\",\r\n          productId: detail.productId,\r\n          qty: parseInt(detail.qty),\r\n        });\r\n      });\r\n    },\r\n    apiCalls() {\r\n      return new Promise((resolve, reject) => {\r\n        //creating sale\r\n        axios\r\n          .post(\"/api/orders/create\", { userId: this.$store.getters.getUserId })\r\n          .then((res) => {\r\n            this.$store.dispatch(\"addOrder\", res.data.payload);\r\n            //creating sale details\r\n            let orderId = res.data.payload._id;\r\n            this.order.forEach((product) => {\r\n              axios\r\n                .post(\"/api/order-details/create\", {\r\n                  orderId: orderId,\r\n                  productId: product.productId,\r\n                  price: product.price,\r\n                  qty: parseInt(product.qty),\r\n                })\r\n                .then((res) => {\r\n                  console.log(res);\r\n                  resolve();\r\n                })\r\n                .catch((err) => {\r\n                  console.error(err);\r\n                  reject(err);\r\n                });\r\n            });\r\n          })\r\n          .catch((err) => {\r\n            console.error(err);\r\n          });\r\n      });\r\n    },\r\n  },\r\n  computed: {\r\n    products() {\r\n      return this.$store.getters.getProducts;\r\n    },\r\n    getTotal() {\r\n      return this.order.reduce(\r\n        (a, b) => a + this.getProductPrice(b.productId) * b.qty,\r\n        0\r\n      );\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.total {\r\n  font-size: 24px;\r\n}\r\n.date-width {\r\n  max-width: 300px;\r\n}\r\n.search-field {\r\n  display: inline-block;\r\n  width: 300px;\r\n}\r\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./addSale.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./addSale.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./addSale.vue?vue&type=template&id=3a20c00c&scoped=true&\"\nimport script from \"./addSale.vue?vue&type=script&lang=js&\"\nexport * from \"./addSale.vue?vue&type=script&lang=js&\"\nimport style0 from \"./addSale.vue?vue&type=style&index=0&id=3a20c00c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3a20c00c\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VAlert } from 'vuetify/lib/components/VAlert';\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VDatePicker } from 'vuetify/lib/components/VDatePicker';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VMenu } from 'vuetify/lib/components/VMenu';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSelect } from 'vuetify/lib/components/VSelect';\nimport { VSimpleTable } from 'vuetify/lib/components/VDataTable';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VTextField } from 'vuetify/lib/components/VTextField';\ninstallComponents(component, {VAlert,VBtn,VCard,VContainer,VDatePicker,VIcon,VMenu,VRow,VSelect,VSimpleTable,VSpacer,VTextField})\n","var aFunction = require('../internals/a-function');\nvar toObject = require('../internals/to-object');\nvar IndexedObject = require('../internals/indexed-object');\nvar toLength = require('../internals/to-length');\n\n// `Array.prototype.{ reduce, reduceRight }` methods implementation\nvar createMethod = function (IS_RIGHT) {\n  return function (that, callbackfn, argumentsLength, memo) {\n    aFunction(callbackfn);\n    var O = toObject(that);\n    var self = IndexedObject(O);\n    var length = toLength(O.length);\n    var index = IS_RIGHT ? length - 1 : 0;\n    var i = IS_RIGHT ? -1 : 1;\n    if (argumentsLength < 2) while (true) {\n      if (index in self) {\n        memo = self[index];\n        index += i;\n        break;\n      }\n      index += i;\n      if (IS_RIGHT ? index < 0 : length <= index) {\n        throw TypeError('Reduce of empty array with no initial value');\n      }\n    }\n    for (;IS_RIGHT ? index >= 0 : length > index; index += i) if (index in self) {\n      memo = callbackfn(memo, self[index], index, O);\n    }\n    return memo;\n  };\n};\n\nmodule.exports = {\n  // `Array.prototype.reduce` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.reduce\n  left: createMethod(false),\n  // `Array.prototype.reduceRight` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.reduceright\n  right: createMethod(true)\n};\n"],"sourceRoot":""}