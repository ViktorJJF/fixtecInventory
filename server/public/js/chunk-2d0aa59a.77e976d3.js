(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0aa59a"],{1148:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("custom-card",{attrs:{title:"Historial de ventas",icon:"mdi-format-list-checks"},scopedSlots:e._u([{key:"content",fn:function(){return[a("v-row",{staticClass:"mb-3",attrs:{align:"center"}},[a("v-col",{attrs:{cols:"12",sm:"4"}},[a("span",{staticClass:"body-1 font-weight-bold d-inline mx-3"},[e._v("Desde:")]),a("v-text-field",{staticClass:"mr-3 mb-3",attrs:{outlined:"",dense:"","prepend-icon":"event",type:"date","hide-details":"",clearable:""},model:{value:e.filters.startDate,callback:function(t){e.$set(e.filters,"startDate",t)},expression:"filters.startDate"}})],1),a("v-col",{attrs:{cols:"12",sm:"4"}},[a("span",{staticClass:"body-1 font-weight-bold d-inline mx-3"},[e._v("Hasta:")]),a("v-text-field",{staticClass:"mr-3 mb-3",attrs:{outlined:"",dense:"","prepend-icon":"event",type:"date","hide-details":"",clearable:""},model:{value:e.filters.endDate,callback:function(t){e.$set(e.filters,"endDate",t)},expression:"filters.endDate"}})],1),a("v-col",{attrs:{cols:"12",sm:"4"}},[a("span",{staticClass:"body-1 font-weight-bold d-inline mx-3"},[e._v("Negocio:")]),a("v-select",{staticClass:"mr-3 mb-3",attrs:{clearable:"","hide-details":"",dense:"",placeholder:"Selecciona un negocio",items:e.commerce,outlined:""},on:{"click:clear":function(t){e.filters.commerce=null}},model:{value:e.filters.commerce,callback:function(t){e.$set(e.filters,"commerce",t)},expression:"filters.commerce"}})],1),a("v-col",{attrs:{cols:"12",sm:"6"}},[a("span",{staticClass:"body-1 font-weight-bold d-inline mx-3"},[e._v("Filtrar por producto:")]),a("v-dialog",{attrs:{width:"1200"},scopedSlots:e._u([{key:"activator",fn:function(t){var s=t.on;return[a("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-btn",e._g({staticClass:"my-3 mr-3",attrs:{tile:"",color:"primary"}},Object.assign({},r,s)),[a("v-icon",{attrs:{left:""}},[e._v("search")]),e._v("Seleccionar producto ")],1)]}}],null,!0)},[a("span",[e._v("Inventario")])])]}}]),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("v-card",[a("v-toolbar",{attrs:{color:"primary",dark:""}},[a("v-toolbar-title",[e._v("Productos")])],1),a("v-container",[a("products",{attrs:{selectButton:!0},on:{"add-product":function(t){e.filters.product=t._id,e.dialog=!1}}})],1),a("v-divider"),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"primary",text:""},on:{click:function(t){e.dialog=!1}}},[e._v("De acuerdo")])],1)],1)],1)],1),a("v-col",{attrs:{cols:"12",sm:"6"}},[a("v-row",{directives:[{name:"show",rawName:"v-show",value:e.filters.product,expression:"filters.product"}]},[e.filters.product?a("v-simple-table",{scopedSlots:e._u([{key:"default",fn:function(){return[a("thead",[a("tr",[a("th",{staticClass:"text-left"},[a("span",[e._v("Tipo")])]),a("th",{staticClass:"text-left"},[a("span",[e._v("Nombre")])]),a("th",{staticClass:"text-left"},[a("span",[e._v("Marca")])])])]),a("tbody",[a("tr",[a("td",[e._v(e._s(e.productById(e.filters.product).typeId?e.productById(e.filters.product).typeId.name:"Sin tipo"))]),a("td",[e._v(e._s(e.productById(e.filters.product).name))]),a("td",[e._v(e._s(e.productById(e.filters.product).brandId?e.productById(e.filters.product).brandId.name:"Sin marca"))]),a("td",[a("v-btn",{attrs:{color:"error",small:""},on:{click:function(t){e.filters.product=null}}},[e._v("Limpiar")])],1)])])]},proxy:!0}],null,!1,1458898029)}):e._e()],1)],1)],1),a("v-row",{attrs:{justify:"center"}},[a("v-col",{attrs:{cols:"12",sm:"6"}},[a("v-btn",{attrs:{block:"",color:"success"},on:{click:function(t){return e.initialData(1,e.filters)}}},[e._v("Buscar!")])],1)],1),a("v-col",{attrs:{cols:"12",sm:"12"}},[a("p",[a("strong",[e._v("Cantidad de ventas:")]),e._v(" "+e._s(e.$store.state.salesModule.total)+" ")])]),a("div",{staticClass:"text-center pt-2"},[a("v-pagination",{attrs:{length:e.totalPages},on:{input:function(t){return e.initialData(e.page,e.filters)}},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}})],1),a("v-data-table",{staticClass:"elevation-1",attrs:{loading:!e.isDataReady,headers:e.headers,items:e.sales,options:e.pagination,"items-per-page":500,"hide-default-footer":"","server-items-length":e.totalItems},on:{"update:options":function(t){e.pagination=t}},scopedSlots:e._u([{key:"no-data",fn:function(){return[a("v-alert",{attrs:{type:"error",value:!0}},[e._v("Aún no cuentas con un historial de ventas")])]},proxy:!0},{key:"item.userId",fn:function(t){var a=t.item;return[e._v(e._s(a.userId.email))]}},{key:"item.products",fn:function(t){var s=t.item;return[a("ul",e._l(s.products,(function(t){return a("li",{key:t._id},[e._v(e._s(t.productId?t.productId.name:"Producto eliminado")+" ("+e._s(t.qty)+" x S/."+e._s(t.salePrice)+")")])})),0)]}},{key:"item.amount",fn:function(t){var s=t.item;return[a("span",{staticClass:"ganancia"},[e._v("S/."+e._s(e.totalRevenue(s.products)))])]}},{key:"item.commerce",fn:function(t){var s=t.item;return[a("span",[e._v(e._s(s.commerce))])]}},{key:"item.date",fn:function(t){var s=t.item;return[a("div",[a("v-text-field",{directives:[{name:"show",rawName:"v-show",value:e.editMode&&s._id==e.editedIndex,expression:"editMode && item._id==editedIndex"}],staticClass:"mt-4",attrs:{outlined:"",dense:"","prepend-icon":"event",type:"date"},model:{value:e.editedDate,callback:function(t){e.editedDate=t},expression:"editedDate"}}),a("span",{directives:[{name:"show",rawName:"v-show",value:!e.editMode||s._id!=e.editedIndex,expression:"!editMode || item._id!=editedIndex"}]},[e._v(e._s(e._f("formatDate")(s.date)))]),a("v-chip",{directives:[{name:"show",rawName:"v-show",value:!!s.products[0]&&s.products[0].history,expression:"item.products[0]?item.products[0].history:false"}],staticClass:"ma-2",attrs:{color:"info",small:""}},[e._v("Histórico")])],1)]}},{key:"item.actions",fn:function(t){var s=t.item;return[a("v-btn",{directives:[{name:"show",rawName:"v-show",value:!e.editMode||s._id!=e.editedIndex,expression:"!editMode || item._id!=editedIndex"}],staticClass:"mr-2 my-2",attrs:{small:"",color:"info"},on:{click:function(t){e.editMode=!0,e.editedIndex=s._id,e.editedDate=new Date(s.date).toISOString().substr(0,10)}}},[e._v("Editar")]),a("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.editMode&&s._id==e.editedIndex,expression:"editMode && item._id==editedIndex"}],staticClass:"mr-2 my-2",attrs:{small:"",color:"success"},on:{click:function(t){e.saveSale(s),e.editMode=!1}}},[e._v("Guardar")]),a("v-btn",{staticClass:"mb-2 my-2",attrs:{small:"",color:"error"},on:{click:function(t){return e.deleteItem(s)}}},[e._v("Eliminar")])]}},{key:"item.createdAt",fn:function(t){var a=t.item;return[e._v(e._s(e._f("formatDate")(a.createdAt)))]}}])}),a("div",{staticClass:"text-center pt-2"},[a("v-pagination",{attrs:{length:e.totalPages},on:{input:function(t){return e.initialData(e.page,e.filters)}},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}})],1)]},proxy:!0}])})},r=[],o=(a("c975"),a("13d5"),a("a434"),a("b680"),a("b85c")),n=(a("96cf"),a("1da1")),i=a("5530"),c=a("b166"),d=a("2f62"),l=a("fa7d"),u=a("d101"),p={components:{products:u["a"]},filters:{formatDate:function(e){return Object(c["a"])(new Date(e),"dd/MM/yyyy")}},data:function(){return{filters:{startDate:null,endDate:null,commerce:null,product:null},editedDate:null,editedIndex:null,editMode:!1,page:1,pageCount:0,itemsPerPage:10,isDataReady:!1,selectedOrder:0,pagination:{},search:"",dialog:!1,headers:[{text:"Negocio",value:"commerce"},{text:"Fecha de venta",value:"date"},{text:"Vendedor",value:"userId"},{text:"Productos vendidos",value:"products"},{text:"Beneficio",value:"amount"},{text:"Acciones",value:"actions"}],sales:[],orderDetails:[]}},computed:Object(i["a"])(Object(i["a"])({totalItems:function(){return this.$store.state.salesModule.totalSales},totalPages:function(){return this.$store.state.salesModule.totalPages}},Object(d["b"])({productById:"productsModule/productById"})),{},{commerce:function(){return this.$store.state.commerce}}),created:function(){this.initialData()},methods:{initialData:function(e,t){var a=this;return Object(n["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,a.$store.dispatch("loadingModule/showLoading"),e=e||1,s.t0=a,s.next=6,a.$store.dispatch("salesModule/listWithProducts",Object(i["a"])(Object(i["a"])({},t),Object(l["a"])({page:e,itemsPerPage:a.$store.state.itemsPerPage})));case 6:s.t1=s.sent,a.sales=s.t0.$deepCopy.call(s.t0,s.t1),s.next=13;break;case 10:s.prev=10,s.t2=s["catch"](0),console.log("algo salio mal...:",s.t2);case 13:return s.prev=13,a.$store.dispatch("loadingModule/showLoading",!1),s.finish(13);case 16:a.isDataReady=!0;case 17:case"end":return s.stop()}}),s,null,[[0,10,13,16]])})))()},saveSale:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=new Date(t.editedDate),s=new Date(s.getTime()- -6e4*s.getTimezoneOffset()),e.date=s,a.next=5,t.$store.dispatch("salesModule/update",{id:e._id,data:{commerce:e.commerce,date:s}});case 5:case"end":return a.stop()}}),a)})))()},totalRevenue:function(e){return e?e.reduce((function(e,t){return e+t.salePrice*t.qty}),0).toFixed(2):"S/.0"},deleteItem:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var s,r,n,i,c,d;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=t.sales.indexOf(e),r=t.sales[s]._id,n=t.sales[s].products,a.next=5,t.$confirm("¿Seguro que deseas eliminar esta venta? Se sumará el stock a los productos del detalle");case 5:if(!a.sent){a.next=21;break}return a.prev=6,t.$store.dispatch("loadingModule/showLoading"),a.next=10,t.$store.dispatch("salesModule/delete",r);case 10:i=Object(o["a"])(n);try{for(i.s();!(c=i.n()).done;)d=c.value,console.log("este es el history: ",d.history),d.history||t.$store.commit("productsModule/updateStock",{productId:d.productId._id,qty:d.qty})}catch(l){i.e(l)}finally{i.f()}t.sales.splice(s,1),a.next=18;break;case 15:a.prev=15,a.t0=a["catch"](6),console.log(a.t0);case 18:return a.prev=18,t.$store.dispatch("loadingModule/showLoading",!1),a.finish(18);case 21:case"end":return a.stop()}}),a,null,[[6,15,18,21]])})))()}}},m=p,v=a("2877"),f=a("6544"),h=a.n(f),g=a("0798"),b=a("8336"),_=a("b0af"),y=a("99d9"),x=a("cc20"),w=a("62ad"),k=a("a523"),D=a("8fea"),I=a("169a"),C=a("ce7e"),M=a("132d"),S=a("891e"),V=a("0fd9"),$=a("b974"),O=a("1f4f"),P=a("2fa4"),j=a("8654"),R=a("71d9"),B=a("2a7f"),T=a("3a2f"),N=Object(v["a"])(m,s,r,!1,null,"05a46df0",null);t["default"]=N.exports;h()(N,{VAlert:g["a"],VBtn:b["a"],VCard:_["a"],VCardActions:y["b"],VChip:x["a"],VCol:w["a"],VContainer:k["a"],VDataTable:D["a"],VDialog:I["a"],VDivider:C["a"],VIcon:M["a"],VPagination:S["a"],VRow:V["a"],VSelect:$["a"],VSimpleTable:O["a"],VSpacer:P["a"],VTextField:j["a"],VToolbar:R["a"],VToolbarTitle:B["c"],VTooltip:T["a"]})}}]);
//# sourceMappingURL=chunk-2d0aa59a.77e976d3.js.map